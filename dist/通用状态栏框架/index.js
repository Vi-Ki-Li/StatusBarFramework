import'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';import'https://testingcf.jsdelivr.net/npm/json5/+esm';import'https://testingcf.jsdelivr.net/npm/jsonrepair/+esm';import'https://testingcf.jsdelivr.net/npm/zod/v4/core/+esm';var e={12(e,t,n){var a=n(405);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,n(424).A)('01ed18ce',a,!1,{ssrId:!0})},80(e,t,n){var a=n(626);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,n(424).A)('4aff3852',a,!1,{ssrId:!0})},109(e,t,n){var a=n(670);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,n(424).A)('eb064dae',a,!1,{ssrId:!0})},405(e,t,n){n.r(t),n.d(t,{default:()=>s});var a=n(699),r=n.n(a),o=n(465),i=n.n(o)()(r());i.push([e.id,'.definition-studio[data-v-06c478c0]{display:flex;height:100%;overflow:hidden;background:var(--bg-app,#f9fafb)}.studio__sidebar[data-v-06c478c0]{width:260px;min-width:260px;background:rgba(255,255,255,0.8);border-right:1px solid var(--border-base,rgba(0,0,0,0.08));display:flex;flex-direction:column;transition:all 0.3s ease}.studio__sidebar--collapsed[data-v-06c478c0]{width:0;min-width:0;opacity:0;overflow:hidden}.studio__sidebar-header[data-v-06c478c0]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid var(--border-base,rgba(0,0,0,0.08))}.studio__sidebar-title[data-v-06c478c0]{font-size:0.85rem;font-weight:600;color:var(--text-secondary,#6b7280);text-transform:uppercase;letter-spacing:0.05em}.studio__sidebar-content[data-v-06c478c0]{flex:1;overflow-y:auto;padding:8px}.studio__category-item[data-v-06c478c0]{width:100%;display:flex;align-items:center;gap:10px;padding:10px 12px;border:none;border-radius:8px;background:transparent;color:var(--text-secondary,#6b7280);font-size:0.9rem;cursor:pointer;transition:all 0.2s ease;text-align:left}.studio__category-item[data-v-06c478c0]:hover{background:var(--surface-hover,rgba(0,0,0,0.04));color:var(--text-primary,#1f2937)}.studio__category-item--active[data-v-06c478c0]{background:var(--color-primary-subtle,rgba(99,102,241,0.1));color:var(--color-primary,#6366f1)}.studio__category-count[data-v-06c478c0]{margin-left:auto;font-size:0.75rem;background:var(--surface-hover,rgba(0,0,0,0.05));padding:2px 8px;border-radius:10px}.studio__category-badge[data-v-06c478c0]{font-size:0.65rem;padding:2px 6px;border-radius:4px;background:var(--color-primary-subtle,rgba(99,102,241,0.1));color:var(--color-primary,#6366f1)}.studio__category-badge--shared[data-v-06c478c0]{background:rgba(16,185,129,0.1);color:#10b981}.studio__category-actions[data-v-06c478c0]{display:none;gap:4px;margin-left:auto}.studio__category-item:hover .studio__category-actions[data-v-06c478c0]{display:flex}.studio__category-item:hover .studio__category-count[data-v-06c478c0],.studio__category-item:hover .studio__category-badge[data-v-06c478c0]{display:none}.studio__main[data-v-06c478c0]{flex:1;display:flex;flex-direction:column;min-width:0;overflow:hidden}.studio__toolbar[data-v-06c478c0]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;border-bottom:1px solid var(--border-base,rgba(0,0,0,0.08));background:rgba(255,255,255,0.6)}.studio__section-title[data-v-06c478c0]{font-size:1.1rem;font-weight:600;color:var(--text-primary,#1f2937);margin:0}.studio__item-count[data-v-06c478c0]{font-weight:400;color:var(--text-tertiary,#9ca3af);font-size:0.9rem}.studio__toolbar-actions[data-v-06c478c0]{display:flex;gap:8px}.studio__items-grid[data-v-06c478c0]{flex:1;overflow-y:auto;padding:24px;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;align-content:start}.studio__item-card[data-v-06c478c0]{background:#fff;border:1px solid var(--border-base,rgba(0,0,0,0.08));border-radius:12px;padding:16px;cursor:pointer;transition:all 0.2s ease;position:relative}.studio__item-card[data-v-06c478c0]:hover{border-color:var(--color-primary,#6366f1);box-shadow:0 4px 12px rgba(99,102,241,0.15);transform:translateY(-2px)}.studio__item-header[data-v-06c478c0]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.studio__item-key[data-v-06c478c0]{font-family:monospace;font-size:0.85rem;color:var(--color-primary,#6366f1);background:var(--color-primary-subtle,rgba(99,102,241,0.1));padding:2px 8px;border-radius:4px}.studio__item-type[data-v-06c478c0]{font-size:0.7rem;padding:2px 6px;border-radius:4px;background:rgba(99,102,241,0.1);color:#6366f1}.studio__item-type--list[data-v-06c478c0]{background:rgba(245,158,11,0.1);color:#f59e0b}.studio__item-name[data-v-06c478c0]{font-weight:600;color:var(--text-primary,#1f2937);margin-bottom:8px}.studio__item-parts[data-v-06c478c0]{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}.studio__part-tag[data-v-06c478c0]{font-size:0.75rem;padding:2px 6px;border-radius:4px;background:var(--surface-hover,rgba(0,0,0,0.05));color:var(--text-secondary,#6b7280)}.studio__item-format[data-v-06c478c0]{font-family:monospace;font-size:0.75rem;color:var(--text-tertiary,#9ca3af);background:var(--surface-hover,rgba(0,0,0,0.03));padding:6px 8px;border-radius:6px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.studio__item-actions[data-v-06c478c0]{position:absolute;top:12px;right:12px;display:none}.studio__item-card:hover .studio__item-actions[data-v-06c478c0]{display:flex}.studio__empty[data-v-06c478c0]{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px;color:var(--text-tertiary,#9ca3af)}.studio__empty svg[data-v-06c478c0]{opacity:0.5;margin-bottom:16px}.studio__empty p[data-v-06c478c0]{margin:0 0 16px}.studio__btn[data-v-06c478c0]{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:1px solid var(--border-base,rgba(0,0,0,0.1));border-radius:8px;background:#fff;color:var(--text-secondary,#6b7280);font-size:0.875rem;font-weight:500;cursor:pointer;transition:all 0.2s ease}.studio__btn[data-v-06c478c0]:hover{background:var(--surface-hover,rgba(0,0,0,0.04));border-color:var(--border-base,rgba(0,0,0,0.15))}.studio__btn--primary[data-v-06c478c0]{background:linear-gradient(135deg,var(--color-primary,#6366f1),#4f46e5);color:#fff;border:none}.studio__btn--primary[data-v-06c478c0]:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(99,102,241,0.3)}.studio__btn--secondary[data-v-06c478c0]{background:var(--color-primary-subtle,rgba(99,102,241,0.1));color:var(--color-primary,#6366f1);border:none}.studio__btn--small[data-v-06c478c0]{padding:4px 10px;font-size:0.8rem}.studio__icon-btn[data-v-06c478c0]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:none;border-radius:8px;background:transparent;color:var(--text-tertiary,#9ca3af);cursor:pointer;transition:all 0.2s ease}.studio__icon-btn[data-v-06c478c0]:hover{background:var(--surface-hover,rgba(0,0,0,0.05));color:var(--text-primary,#1f2937)}.studio__mini-btn[data-v-06c478c0]{width:24px;height:24px;display:flex;align-items:center;justify-content:center;border:none;border-radius:4px;background:transparent;color:var(--text-tertiary,#9ca3af);cursor:pointer;transition:all 0.15s ease}.studio__mini-btn[data-v-06c478c0]:hover{background:var(--surface-hover,rgba(0,0,0,0.08));color:var(--text-primary,#1f2937)}.studio__mini-btn--danger[data-v-06c478c0]:hover{background:rgba(239,68,68,0.1);color:#ef4444}.studio__mini-btn[data-v-06c478c0]:disabled{opacity:0.3;cursor:not-allowed}.studio__drawer-overlay[data-v-06c478c0]{position:fixed;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000}.studio__drawer[data-v-06c478c0]{width:420px;max-width:95vw;max-height:90vh;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,0.2);display:flex;flex-direction:column;overflow:hidden}.studio__drawer--wide[data-v-06c478c0]{width:600px}.studio__drawer-header[data-v-06c478c0]{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--border-base,rgba(0,0,0,0.08))}.studio__drawer-header h3[data-v-06c478c0]{margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary,#1f2937)}.studio__drawer-content[data-v-06c478c0]{flex:1;overflow-y:auto;padding:24px}.studio__drawer-footer[data-v-06c478c0]{display:flex;justify-content:flex-end;gap:8px;padding:16px 24px;border-top:1px solid var(--border-base,rgba(0,0,0,0.08));background:rgba(249,250,251,0.9)}.studio__form-group[data-v-06c478c0]{margin-bottom:16px}.studio__form-group label[data-v-06c478c0]{display:block;font-size:0.85rem;font-weight:500;color:var(--text-secondary,#6b7280);margin-bottom:6px}.studio__form-group input[data-v-06c478c0],.studio__form-group select[data-v-06c478c0],.studio__form-group textarea[data-v-06c478c0]{width:100%;padding:10px 12px;border:1px solid var(--border-base,rgba(0,0,0,0.1));border-radius:8px;font-size:0.9rem;color:var(--text-primary,#1f2937);background:#fff;transition:border-color 0.2s ease}.studio__form-group input[data-v-06c478c0]:focus,.studio__form-group select[data-v-06c478c0]:focus,.studio__form-group textarea[data-v-06c478c0]:focus{outline:none;border-color:var(--color-primary,#6366f1);box-shadow:0 0 0 3px var(--color-primary-subtle,rgba(99,102,241,0.1))}.studio__form-row[data-v-06c478c0]{display:flex;gap:16px}.studio__form-row .studio__form-group[data-v-06c478c0]{flex:1}.studio__form-group--small[data-v-06c478c0]{max-width:100px}.studio__radio-group[data-v-06c478c0]{display:flex;gap:16px}.studio__radio[data-v-06c478c0]{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:0.9rem;color:var(--text-secondary,#6b7280)}.studio__radio input[type="radio"][data-v-06c478c0]{width:auto;margin:0}.studio__parts-header[data-v-06c478c0]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.studio__parts-list[data-v-06c478c0]{display:flex;flex-direction:column;gap:8px}.studio__part-row[data-v-06c478c0]{display:flex;gap:8px;align-items:center}.studio__part-input[data-v-06c478c0]{flex:1;padding:8px 10px !important;font-size:0.85rem !important}.studio__part-select[data-v-06c478c0]{width:90px;padding:8px 6px !important;font-size:0.85rem !important}.studio__part-actions[data-v-06c478c0]{display:flex;gap:2px}.studio__format-preview[data-v-06c478c0]{font-family:monospace;font-size:0.9rem;padding:12px;background:var(--surface-hover,rgba(0,0,0,0.03));border-radius:8px;border:1px solid var(--border-base,rgba(0,0,0,0.08));color:var(--color-primary,#6366f1)}\n','',{version:3,sources:['webpack://./src/通用状态栏框架/components/manager/modules/DefinitionStudio.vue'],names:[],mappings:'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',sourcesContent:['<script setup lang="ts">\n/**\n * 定义工坊 (Definition Studio)\n *\n * 功能：全局的"条目字典"，用于创建和管理所有分类和数据条目的结构和元数据\n *\n * 根据开发总纲：\n * - 分类列表：CRUD 数据类别，设定 shared/character 属性\n * - 条目列表：按类别分组，提供 CRUD\n * - 属性编辑器：key, name, category, icon, entry_type, parts, ui_type, separator, etc.\n */\nimport type {\n    CategoryDefinition,\n    CategoryScope,\n    DataType,\n    EntryType,\n    ItemDefinition\n} from \'@/通用状态栏框架/types\';\nimport { computed, reactive, ref } from \'vue\';\n\n// ==================== 状态 ====================\n\nconst categories = ref<Record<string, CategoryDefinition>>({});\nconst itemDefinitions = ref<Record<string, ItemDefinition>>({});\n\n// UI 状态\nconst selectedCategoryKey = ref<string | null>(null);\nconst isSidebarCollapsed = ref(false);\nconst isEditingCategory = ref(false);\nconst isEditingItem = ref(false);\n\n// 编辑表单\nconst categoryForm = reactive<CategoryDefinition>({\n  key: \'\',\n  name: \'\',\n  icon: \'folder\',\n  order: 0,\n  scope: \'character\',\n});\n\nconst itemForm = reactive<ItemDefinition>({\n  key: \'\',\n  name: \'\',\n  icon: \'\',\n  category: \'\',\n  entry_type: \'Single\',\n  parts: [],\n  separator: \'|\',\n  secondary_separator: \'@\',\n  description: \'\',\n});\n\n// ==================== 计算属性 ====================\n\nconst sortedCategories = computed(() =>\n  Object.values(categories.value).sort((a, b) => a.order - b.order)\n);\n\nconst filteredItems = computed(() => {\n  const items = Object.values(itemDefinitions.value);\n  if (!selectedCategoryKey.value) return items;\n  return items.filter(item => item.category === selectedCategoryKey.value);\n});\n\nconst currentCategory = computed(() =>\n  selectedCategoryKey.value ? categories.value[selectedCategoryKey.value] : null\n);\n\n// 自动生成格式字符串\nconst generatedFormat = computed(() => {\n  if (!itemForm.key || !itemForm.category) return \'\';\n\n  const cat = categories.value[itemForm.category];\n  const scope = cat?.scope === \'shared\' ? \'ST\' : \'{角色}\';\n  const categoryKey = itemForm.category;\n\n  let valuePart = \'\';\n  if (itemForm.parts.length === 0) {\n    valuePart = `{${itemForm.key}}`;\n  } else if (itemForm.entry_type === \'Single\') {\n    valuePart = itemForm.parts.map(p => `{${p.key}}`).join(itemForm.separator);\n  } else {\n    // List\n    const partTemplate = itemForm.parts.length > 1\n      ? itemForm.parts.map(p => `{${p.key}}`).join(itemForm.secondary_separator || \'@\')\n      : `{${itemForm.parts[0]?.key || \'item\'}}`;\n    valuePart = `${partTemplate}${itemForm.separator}...`;\n  }\n\n  return `[${scope}^${categoryKey}|${itemForm.key}::${valuePart}]`;\n});\n\n// ==================== 分类操作 ====================\n\nfunction openNewCategory() {\n  Object.assign(categoryForm, {\n    key: \'\',\n    name: \'\',\n    icon: \'folder\',\n    order: sortedCategories.value.length,\n    scope: \'character\' as CategoryScope,\n  });\n  isEditingCategory.value = true;\n}\n\nfunction editCategory(cat: CategoryDefinition) {\n  Object.assign(categoryForm, { ...cat });\n  isEditingCategory.value = true;\n}\n\nfunction saveCategory() {\n  if (!categoryForm.key.trim() || !categoryForm.name.trim()) return;\n\n  categories.value[categoryForm.key] = { ...categoryForm };\n  isEditingCategory.value = false;\n}\n\nfunction deleteCategory(key: string) {\n  if (confirm(`确定删除分类 "${categories.value[key]?.name}"？\\n注意：不会删除属于该分类的条目定义。`)) {\n    delete categories.value[key];\n    if (selectedCategoryKey.value === key) {\n      selectedCategoryKey.value = null;\n    }\n  }\n}\n\n// ==================== 条目操作 ====================\n\nfunction openNewItem() {\n  Object.assign(itemForm, {\n    key: \'\',\n    name: \'\',\n    icon: \'\',\n    category: selectedCategoryKey.value || \'\',\n    entry_type: \'Single\' as EntryType,\n    parts: [{ key: \'value\', label: \'值\', data_type: \'string\' as DataType }],\n    separator: \'|\',\n    secondary_separator: \'@\',\n    description: \'\',\n  });\n  isEditingItem.value = true;\n}\n\nfunction editItem(item: ItemDefinition) {\n  Object.assign(itemForm, {\n    ...item,\n    parts: item.parts.map(p => ({ ...p })),\n  });\n  isEditingItem.value = true;\n}\n\nfunction saveItem() {\n  if (!itemForm.key.trim() || !itemForm.name.trim()) return;\n\n  // 更新 format\n  itemForm.format = generatedFormat.value;\n\n  itemDefinitions.value[itemForm.key] = {\n    ...itemForm,\n    parts: itemForm.parts.map(p => ({ ...p })),\n  };\n  isEditingItem.value = false;\n}\n\nfunction deleteItem(key: string) {\n  if (confirm(`确定删除条目定义 "${itemDefinitions.value[key]?.name}"？`)) {\n    delete itemDefinitions.value[key];\n  }\n}\n\n// ==================== Parts 操作 ====================\n\nfunction addPart() {\n  itemForm.parts.push({\n    key: \'\',\n    label: \'\',\n    data_type: \'string\',\n  });\n}\n\nfunction removePart(index: number) {\n  itemForm.parts.splice(index, 1);\n}\n\nfunction movePart(index: number, direction: -1 | 1) {\n  const newIndex = index + direction;\n  if (newIndex < 0 || newIndex >= itemForm.parts.length) return;\n  const temp = itemForm.parts[index];\n  itemForm.parts[index] = itemForm.parts[newIndex];\n  itemForm.parts[newIndex] = temp;\n}\n\n// ==================== 图标 ====================\n\nconst iconPaths: Record<string, string> = {\n  folder: \'M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z\',\n  plus: \'M12 5v14M5 12h14\',\n  edit: \'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\',\n  trash: \'M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\',\n  save: \'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2zM17 21v-8H7v8M7 3v5h8\',\n  x: \'M18 6L6 18M6 6l12 12\',\n  chevronUp: \'M18 15l-6-6-6 6\',\n  chevronDown: \'M6 9l6 6 6-6\',\n  database: \'M12 2C6.48 2 2 4.69 2 8v8c0 3.31 4.48 6 10 6s10-2.69 10-6V8c0-3.31-4.48-6-10-6zm0 2c4.42 0 8 1.79 8 4s-3.58 4-8 4-8-1.79-8-4 3.58-4 8-4z\',\n  box: \'M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z\',\n  list: \'M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01\',\n  singleUser: \'M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z\',\n  users: \'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z\',\n  upload: \'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12\',\n};\n<\/script>\n\n<template>\n  <div class="definition-studio">\n    \x3c!-- 左侧分类列表 --\x3e\n    <aside class="studio__sidebar" :class="{ \'studio__sidebar--collapsed\': isSidebarCollapsed }">\n      <div class="studio__sidebar-header">\n        <span class="studio__sidebar-title">分类列表</span>\n        <button class="studio__icon-btn" title="新建分类" @click="openNewCategory">\n          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">\n            <path :d="iconPaths.plus" />\n          </svg>\n        </button>\n      </div>\n\n      <div class="studio__sidebar-content">\n        \x3c!-- 全部 --\x3e\n        <button\n          class="studio__category-item"\n          :class="{ \'studio__category-item--active\': selectedCategoryKey === null }"\n          @click="selectedCategoryKey = null"\n        >\n          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">\n            <path :d="iconPaths.database" />\n          </svg>\n          <span>全部条目</span>\n          <span class="studio__category-count">{{ Object.keys(itemDefinitions).length }}</span>\n        </button>\n\n        \x3c!-- 分类列表 --\x3e\n        <button\n          v-for="cat in sortedCategories"\n          :key="cat.key"\n          class="studio__category-item"\n          :class="{ \'studio__category-item--active\': selectedCategoryKey === cat.key }"\n          @click="selectedCategoryKey = cat.key"\n        >\n          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">\n            <path :d="iconPaths.folder" />\n          </svg>\n          <span>{{ cat.name }}</span>\n          <span class="studio__category-badge" :class="cat.scope === \'shared\' ? \'studio__category-badge--shared\' : \'\'">\n            {{ cat.scope === \'shared\' ? \'共享\' : \'角色\' }}\n          </span>\n          <div class="studio__category-actions">\n            <button class="studio__mini-btn" title="编辑" @click.stop="editCategory(cat)">\n              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.edit" />\n              </svg>\n            </button>\n            <button class="studio__mini-btn studio__mini-btn--danger" title="删除" @click.stop="deleteCategory(cat.key)">\n              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.trash" />\n              </svg>\n            </button>\n          </div>\n        </button>\n      </div>\n    </aside>\n\n    \x3c!-- 主内容区 --\x3e\n    <main class="studio__main">\n      \x3c!-- 工具栏 --\x3e\n      <div class="studio__toolbar">\n        <h2 class="studio__section-title">\n          {{ currentCategory ? currentCategory.name : \'全部条目\' }}\n          <span class="studio__item-count">({{ filteredItems.length }} 项)</span>\n        </h2>\n        <div class="studio__toolbar-actions">\n          <button class="studio__btn studio__btn--primary" @click="openNewItem">\n            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n              <path :d="iconPaths.plus" />\n            </svg>\n            新建条目\n          </button>\n        </div>\n      </div>\n\n      \x3c!-- 条目列表 --\x3e\n      <div class="studio__items-grid">\n        <div\n          v-for="item in filteredItems"\n          :key="item.key"\n          class="studio__item-card"\n          @click="editItem(item)"\n        >\n          <div class="studio__item-header">\n            <span class="studio__item-key">{{ item.key }}</span>\n            <span class="studio__item-type" :class="item.entry_type === \'List\' ? \'studio__item-type--list\' : \'\'">\n              {{ item.entry_type }}\n            </span>\n          </div>\n          <div class="studio__item-name">{{ item.name }}</div>\n          <div class="studio__item-parts">\n            <span v-for="part in item.parts" :key="part.key" class="studio__part-tag">\n              {{ part.label }}\n            </span>\n          </div>\n          <div class="studio__item-format">{{ item.format }}</div>\n          <div class="studio__item-actions">\n            <button class="studio__mini-btn studio__mini-btn--danger" title="删除" @click.stop="deleteItem(item.key)">\n              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.trash" />\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- 空状态 --\x3e\n        <div v-if="filteredItems.length === 0" class="studio__empty">\n          <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5">\n            <path :d="iconPaths.box" />\n          </svg>\n          <p>暂无条目定义</p>\n          <button class="studio__btn studio__btn--primary" @click="openNewItem">创建第一个条目</button>\n        </div>\n      </div>\n    </main>\n\n    \x3c!-- 分类编辑抽屉 --\x3e\n    <Teleport to="body">\n      <div v-if="isEditingCategory" class="studio__drawer-overlay" @click="isEditingCategory = false">\n        <div class="studio__drawer" @click.stop>\n          <div class="studio__drawer-header">\n            <h3>{{ categoryForm.key ? \'编辑分类\' : \'新建分类\' }}</h3>\n            <button class="studio__icon-btn" @click="isEditingCategory = false">\n              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.x" />\n              </svg>\n            </button>\n          </div>\n\n          <div class="studio__drawer-content">\n            <div class="studio__form-group">\n              <label>唯一键 (Key)</label>\n              <input v-model="categoryForm.key" type="text" placeholder="如: CV, CP" />\n            </div>\n            <div class="studio__form-group">\n              <label>显示名称</label>\n              <input v-model="categoryForm.name" type="text" placeholder="如: 角色属性" />\n            </div>\n            <div class="studio__form-group">\n              <label>作用域</label>\n              <div class="studio__radio-group">\n                <label class="studio__radio">\n                  <input v-model="categoryForm.scope" type="radio" value="character" />\n                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n                    <path :d="iconPaths.singleUser" />\n                  </svg>\n                  角色数据\n                </label>\n                <label class="studio__radio">\n                  <input v-model="categoryForm.scope" type="radio" value="shared" />\n                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n                    <path :d="iconPaths.users" />\n                  </svg>\n                  共享数据\n                </label>\n              </div>\n            </div>\n            <div class="studio__form-group">\n              <label>排序权重</label>\n              <input v-model.number="categoryForm.order" type="number" min="0" />\n            </div>\n          </div>\n\n          <div class="studio__drawer-footer">\n            <button class="studio__btn" @click="isEditingCategory = false">取消</button>\n            <button class="studio__btn studio__btn--primary" @click="saveCategory">\n              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.save" />\n              </svg>\n              保存\n            </button>\n          </div>\n        </div>\n      </div>\n    </Teleport>\n\n    \x3c!-- 条目编辑抽屉 --\x3e\n    <Teleport to="body">\n      <div v-if="isEditingItem" class="studio__drawer-overlay" @click="isEditingItem = false">\n        <div class="studio__drawer studio__drawer--wide" @click.stop>\n          <div class="studio__drawer-header">\n            <h3>{{ itemForm.key ? \'编辑条目\' : \'新建条目\' }}</h3>\n            <button class="studio__icon-btn" @click="isEditingItem = false">\n              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.x" />\n              </svg>\n            </button>\n          </div>\n\n          <div class="studio__drawer-content">\n            \x3c!-- 基础信息 --\x3e\n            <div class="studio__form-row">\n              <div class="studio__form-group">\n                <label>唯一键 (Key) *</label>\n                <input v-model="itemForm.key" type="text" placeholder="如: HP, 背包" />\n              </div>\n              <div class="studio__form-group">\n                <label>显示名称 *</label>\n                <input v-model="itemForm.name" type="text" placeholder="如: 生命值" />\n              </div>\n            </div>\n\n            <div class="studio__form-row">\n              <div class="studio__form-group">\n                <label>所属分类</label>\n                <select v-model="itemForm.category">\n                  <option value="">-- 选择分类 --</option>\n                  <option v-for="cat in sortedCategories" :key="cat.key" :value="cat.key">\n                    {{ cat.name }} ({{ cat.key }})\n                  </option>\n                </select>\n              </div>\n              <div class="studio__form-group">\n                <label>条目类型 (entry_type)</label>\n                <div class="studio__radio-group">\n                  <label class="studio__radio">\n                    <input v-model="itemForm.entry_type" type="radio" value="Single" />\n                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n                      <path :d="iconPaths.box" />\n                    </svg>\n                    单体 (Single)\n                  </label>\n                  <label class="studio__radio">\n                    <input v-model="itemForm.entry_type" type="radio" value="List" />\n                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n                      <path :d="iconPaths.list" />\n                    </svg>\n                    列表 (List)\n                  </label>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- 分隔符 --\x3e\n            <div class="studio__form-row">\n              <div class="studio__form-group studio__form-group--small">\n                <label>主分隔符</label>\n                <input v-model="itemForm.separator" type="text" placeholder="|" />\n              </div>\n              <div v-if="itemForm.entry_type === \'List\'" class="studio__form-group studio__form-group--small">\n                <label>次分隔符</label>\n                <input v-model="itemForm.secondary_separator" type="text" placeholder="@" />\n              </div>\n            </div>\n\n            \x3c!-- Parts 结构定义 --\x3e\n            <div class="studio__form-group">\n              <div class="studio__parts-header">\n                <label>结构定义 (Parts)</label>\n                <button class="studio__btn studio__btn--small" @click="addPart">\n                  <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">\n                    <path :d="iconPaths.plus" />\n                  </svg>\n                  添加\n                </button>\n              </div>\n\n              <div class="studio__parts-list">\n                <div v-for="(part, index) in itemForm.parts" :key="index" class="studio__part-row">\n                  <input v-model="part.key" type="text" placeholder="key" class="studio__part-input" />\n                  <input v-model="part.label" type="text" placeholder="标签" class="studio__part-input" />\n                  <select v-model="part.data_type" class="studio__part-select">\n                    <option value="string">文本</option>\n                    <option value="number">数字</option>\n                    <option value="boolean">布尔</option>\n                  </select>\n                  <div class="studio__part-actions">\n                    <button class="studio__mini-btn" :disabled="index === 0" @click="movePart(index, -1)">\n                      <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">\n                        <path :d="iconPaths.chevronUp" />\n                      </svg>\n                    </button>\n                    <button class="studio__mini-btn" :disabled="index === itemForm.parts.length - 1" @click="movePart(index, 1)">\n                      <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">\n                        <path :d="iconPaths.chevronDown" />\n                      </svg>\n                    </button>\n                    <button class="studio__mini-btn studio__mini-btn--danger" @click="removePart(index)">\n                      <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">\n                        <path :d="iconPaths.trash" />\n                      </svg>\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- AI 描述 --\x3e\n            <div class="studio__form-group">\n              <label>AI 描述</label>\n              <textarea v-model="itemForm.description" rows="3" placeholder="给 AI 的说明，如：简述角色当前的生命状态"></textarea>\n            </div>\n\n            \x3c!-- 自动生成的格式 --\x3e\n            <div class="studio__form-group">\n              <label>自动生成格式 (format)</label>\n              <div class="studio__format-preview">{{ generatedFormat }}</div>\n            </div>\n          </div>\n\n          <div class="studio__drawer-footer">\n            <button class="studio__btn" @click="isEditingItem = false">取消</button>\n            <button class="studio__btn studio__btn--secondary">\n              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.upload" />\n              </svg>\n              注入世界书\n            </button>\n            <button class="studio__btn studio__btn--primary" @click="saveItem">\n              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">\n                <path :d="iconPaths.save" />\n              </svg>\n              保存\n            </button>\n          </div>\n        </div>\n      </div>\n    </Teleport>\n  </div>\n</template>\n\n<style scoped>\n/* ========================================\n   定义工坊样式 - 左侧分类 + 右侧条目网格\n   ======================================== */\n\n.definition-studio {\n  display: flex;\n  height: 100%;\n  overflow: hidden;\n  background: var(--bg-app, #f9fafb);\n}\n\n/* ====== 侧边栏 ====== */\n.studio__sidebar {\n  width: 260px;\n  min-width: 260px;\n  background: rgba(255, 255, 255, 0.8);\n  border-right: 1px solid var(--border-base, rgba(0,0,0,0.08));\n  display: flex;\n  flex-direction: column;\n  transition: all 0.3s ease;\n}\n\n.studio__sidebar--collapsed {\n  width: 0;\n  min-width: 0;\n  opacity: 0;\n  overflow: hidden;\n}\n\n.studio__sidebar-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px;\n  border-bottom: 1px solid var(--border-base, rgba(0,0,0,0.08));\n}\n\n.studio__sidebar-title {\n  font-size: 0.85rem;\n  font-weight: 600;\n  color: var(--text-secondary, #6b7280);\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n\n.studio__sidebar-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 8px;\n}\n\n.studio__category-item {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding: 10px 12px;\n  border: none;\n  border-radius: 8px;\n  background: transparent;\n  color: var(--text-secondary, #6b7280);\n  font-size: 0.9rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: left;\n}\n\n.studio__category-item:hover {\n  background: var(--surface-hover, rgba(0,0,0,0.04));\n  color: var(--text-primary, #1f2937);\n}\n\n.studio__category-item--active {\n  background: var(--color-primary-subtle, rgba(99, 102, 241, 0.1));\n  color: var(--color-primary, #6366f1);\n}\n\n.studio__category-count {\n  margin-left: auto;\n  font-size: 0.75rem;\n  background: var(--surface-hover, rgba(0,0,0,0.05));\n  padding: 2px 8px;\n  border-radius: 10px;\n}\n\n.studio__category-badge {\n  font-size: 0.65rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: var(--color-primary-subtle, rgba(99, 102, 241, 0.1));\n  color: var(--color-primary, #6366f1);\n}\n\n.studio__category-badge--shared {\n  background: rgba(16, 185, 129, 0.1);\n  color: #10b981;\n}\n\n.studio__category-actions {\n  display: none;\n  gap: 4px;\n  margin-left: auto;\n}\n\n.studio__category-item:hover .studio__category-actions {\n  display: flex;\n}\n\n.studio__category-item:hover .studio__category-count,\n.studio__category-item:hover .studio__category-badge {\n  display: none;\n}\n\n/* ====== 主内容区 ====== */\n.studio__main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-width: 0;\n  overflow: hidden;\n}\n\n.studio__toolbar {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 16px 24px;\n  border-bottom: 1px solid var(--border-base, rgba(0,0,0,0.08));\n  background: rgba(255,255,255,0.6);\n}\n\n.studio__section-title {\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--text-primary, #1f2937);\n  margin: 0;\n}\n\n.studio__item-count {\n  font-weight: 400;\n  color: var(--text-tertiary, #9ca3af);\n  font-size: 0.9rem;\n}\n\n.studio__toolbar-actions {\n  display: flex;\n  gap: 8px;\n}\n\n/* ====== 条目网格 ====== */\n.studio__items-grid {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n  gap: 16px;\n  align-content: start;\n}\n\n.studio__item-card {\n  background: #fff;\n  border: 1px solid var(--border-base, rgba(0,0,0,0.08));\n  border-radius: 12px;\n  padding: 16px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  position: relative;\n}\n\n.studio__item-card:hover {\n  border-color: var(--color-primary, #6366f1);\n  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);\n  transform: translateY(-2px);\n}\n\n.studio__item-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.studio__item-key {\n  font-family: monospace;\n  font-size: 0.85rem;\n  color: var(--color-primary, #6366f1);\n  background: var(--color-primary-subtle, rgba(99, 102, 241, 0.1));\n  padding: 2px 8px;\n  border-radius: 4px;\n}\n\n.studio__item-type {\n  font-size: 0.7rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: rgba(99, 102, 241, 0.1);\n  color: #6366f1;\n}\n\n.studio__item-type--list {\n  background: rgba(245, 158, 11, 0.1);\n  color: #f59e0b;\n}\n\n.studio__item-name {\n  font-weight: 600;\n  color: var(--text-primary, #1f2937);\n  margin-bottom: 8px;\n}\n\n.studio__item-parts {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 4px;\n  margin-bottom: 8px;\n}\n\n.studio__part-tag {\n  font-size: 0.75rem;\n  padding: 2px 6px;\n  border-radius: 4px;\n  background: var(--surface-hover, rgba(0,0,0,0.05));\n  color: var(--text-secondary, #6b7280);\n}\n\n.studio__item-format {\n  font-family: monospace;\n  font-size: 0.75rem;\n  color: var(--text-tertiary, #9ca3af);\n  background: var(--surface-hover, rgba(0,0,0,0.03));\n  padding: 6px 8px;\n  border-radius: 6px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.studio__item-actions {\n  position: absolute;\n  top: 12px;\n  right: 12px;\n  display: none;\n}\n\n.studio__item-card:hover .studio__item-actions {\n  display: flex;\n}\n\n/* ====== 空状态 ====== */\n.studio__empty {\n  grid-column: 1 / -1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 48px;\n  color: var(--text-tertiary, #9ca3af);\n}\n\n.studio__empty svg {\n  opacity: 0.5;\n  margin-bottom: 16px;\n}\n\n.studio__empty p {\n  margin: 0 0 16px;\n}\n\n/* ====== 按钮 ====== */\n.studio__btn {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 16px;\n  border: 1px solid var(--border-base, rgba(0,0,0,0.1));\n  border-radius: 8px;\n  background: #fff;\n  color: var(--text-secondary, #6b7280);\n  font-size: 0.875rem;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.studio__btn:hover {\n  background: var(--surface-hover, rgba(0,0,0,0.04));\n  border-color: var(--border-base, rgba(0,0,0,0.15));\n}\n\n.studio__btn--primary {\n  background: linear-gradient(135deg, var(--color-primary, #6366f1), #4f46e5);\n  color: #fff;\n  border: none;\n}\n\n.studio__btn--primary:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);\n}\n\n.studio__btn--secondary {\n  background: var(--color-primary-subtle, rgba(99, 102, 241, 0.1));\n  color: var(--color-primary, #6366f1);\n  border: none;\n}\n\n.studio__btn--small {\n  padding: 4px 10px;\n  font-size: 0.8rem;\n}\n\n.studio__icon-btn {\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: none;\n  border-radius: 8px;\n  background: transparent;\n  color: var(--text-tertiary, #9ca3af);\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.studio__icon-btn:hover {\n  background: var(--surface-hover, rgba(0,0,0,0.05));\n  color: var(--text-primary, #1f2937);\n}\n\n.studio__mini-btn {\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border: none;\n  border-radius: 4px;\n  background: transparent;\n  color: var(--text-tertiary, #9ca3af);\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.studio__mini-btn:hover {\n  background: var(--surface-hover, rgba(0,0,0,0.08));\n  color: var(--text-primary, #1f2937);\n}\n\n.studio__mini-btn--danger:hover {\n  background: rgba(239, 68, 68, 0.1);\n  color: #ef4444;\n}\n\n.studio__mini-btn:disabled {\n  opacity: 0.3;\n  cursor: not-allowed;\n}\n\n/* ====== 抽屉 ====== */\n.studio__drawer-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.4);\n  backdrop-filter: blur(4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n\n.studio__drawer {\n  width: 420px;\n  max-width: 95vw;\n  max-height: 90vh;\n  background: #fff;\n  border-radius: 16px;\n  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.studio__drawer--wide {\n  width: 600px;\n}\n\n.studio__drawer-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 24px;\n  border-bottom: 1px solid var(--border-base, rgba(0,0,0,0.08));\n}\n\n.studio__drawer-header h3 {\n  margin: 0;\n  font-size: 1.1rem;\n  font-weight: 600;\n  color: var(--text-primary, #1f2937);\n}\n\n.studio__drawer-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 24px;\n}\n\n.studio__drawer-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n  padding: 16px 24px;\n  border-top: 1px solid var(--border-base, rgba(0,0,0,0.08));\n  background: rgba(249, 250, 251, 0.9);\n}\n\n/* ====== 表单 ====== */\n.studio__form-group {\n  margin-bottom: 16px;\n}\n\n.studio__form-group label {\n  display: block;\n  font-size: 0.85rem;\n  font-weight: 500;\n  color: var(--text-secondary, #6b7280);\n  margin-bottom: 6px;\n}\n\n.studio__form-group input,\n.studio__form-group select,\n.studio__form-group textarea {\n  width: 100%;\n  padding: 10px 12px;\n  border: 1px solid var(--border-base, rgba(0,0,0,0.1));\n  border-radius: 8px;\n  font-size: 0.9rem;\n  color: var(--text-primary, #1f2937);\n  background: #fff;\n  transition: border-color 0.2s ease;\n}\n\n.studio__form-group input:focus,\n.studio__form-group select:focus,\n.studio__form-group textarea:focus {\n  outline: none;\n  border-color: var(--color-primary, #6366f1);\n  box-shadow: 0 0 0 3px var(--color-primary-subtle, rgba(99, 102, 241, 0.1));\n}\n\n.studio__form-row {\n  display: flex;\n  gap: 16px;\n}\n\n.studio__form-row .studio__form-group {\n  flex: 1;\n}\n\n.studio__form-group--small {\n  max-width: 100px;\n}\n\n.studio__radio-group {\n  display: flex;\n  gap: 16px;\n}\n\n.studio__radio {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  cursor: pointer;\n  font-size: 0.9rem;\n  color: var(--text-secondary, #6b7280);\n}\n\n.studio__radio input[type="radio"] {\n  width: auto;\n  margin: 0;\n}\n\n/* ====== Parts 编辑器 ====== */\n.studio__parts-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 8px;\n}\n\n.studio__parts-list {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.studio__part-row {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n\n.studio__part-input {\n  flex: 1;\n  padding: 8px 10px !important;\n  font-size: 0.85rem !important;\n}\n\n.studio__part-select {\n  width: 90px;\n  padding: 8px 6px !important;\n  font-size: 0.85rem !important;\n}\n\n.studio__part-actions {\n  display: flex;\n  gap: 2px;\n}\n\n/* ====== Format 预览 ====== */\n.studio__format-preview {\n  font-family: monospace;\n  font-size: 0.9rem;\n  padding: 12px;\n  background: var(--surface-hover, rgba(0,0,0,0.03));\n  border-radius: 8px;\n  border: 1px solid var(--border-base, rgba(0,0,0,0.08));\n  color: var(--color-primary, #6366f1);\n}\n</style>\n'],sourceRoot:''}]);const s=i},424(e,t,n){function a(e,t){for(var n=[],a={},r=0;r<t.length;r++){var o=t[r],i=o[0],s={id:e+':'+r,css:o[1],media:o[2],sourceMap:o[3]};a[i]?a[i].parts.push(s):n.push(a[i]={id:i,parts:[s]})}return n}n.d(t,{A:()=>m});var r='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!r)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var o={},i=r&&(document.head||document.getElementsByTagName('head')[0]),s=null,l=0,d=!1,c=function(){},A=null,p='data-vue-ssr-id',C='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,t,n,r){d=n,A=r||{};var i=a(e,t);return u(i),function(t){for(var n=[],r=0;r<i.length;r++){var s=i[r];(l=o[s.id]).refs--,n.push(l)}t?u(i=a(e,t)):i=[];for(r=0;r<n.length;r++){var l;if(0===(l=n[r]).refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete o[l.id]}}}}function u(e){for(var t=0;t<e.length;t++){var n=e[t],a=o[n.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](n.parts[r]);for(;r<n.parts.length;r++)a.parts.push(v(n.parts[r]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{var i=[];for(r=0;r<n.parts.length;r++)i.push(v(n.parts[r]));o[n.id]={id:n.id,refs:1,parts:i}}}}function g(){var e=document.createElement('style');return e.type='text/css',i.appendChild(e),e}function v(e){var t,n,a=document.querySelector('style['+p+'~="'+e.id+'"]');if(a){if(d)return c;a.parentNode.removeChild(a)}if(C){var r=l++;a=s||(s=g()),t=h.bind(null,a,r,!1),n=h.bind(null,a,r,!0)}else a=g(),t=x.bind(null,a),n=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else n()}}var b,f=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join('\n')});function h(e,t,n,a){var r=n?'':a.css;if(e.styleSheet)e.styleSheet.cssText=f(t,r);else{var o=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function x(e,t){var n=t.css,a=t.media,r=t.sourceMap;if(a&&e.setAttribute('media',a),A.ssrId&&e.setAttribute(p,t.id),r&&(n+='\n/*# sourceURL='+r.sources[0]+' */',n+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+' */'),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},465(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n='',a=void 0!==t[5];return t[4]&&(n+='@supports ('.concat(t[4],') {')),t[2]&&(n+='@media '.concat(t[2],' {')),a&&(n+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),n+=e(t),a&&(n+='}'),t[2]&&(n+='}'),t[4]&&(n+='}'),n}).join('')},t.i=function(e,n,a,r,o){'string'==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);a&&i[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=o),n&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=n):c[2]=n),r&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=r):c[4]=''.concat(r)),t.push(c))}},t}},626(e,t,n){n.r(t),n.d(t,{default:()=>s});var a=n(699),r=n.n(a),o=n(465),i=n.n(o)()(r());i.push([e.id,'.manager[data-v-c6c4011c]{--modal-bg:rgba(255,255,255,0.98);--modal-border:rgba(0,0,0,0.08);--modal-shadow:0 20px 60px rgba(0,0,0,0.15);--text-primary:#1f2937;--text-secondary:#6b7280;--text-tertiary:#9ca3af;--color-primary:#6366f1;--color-primary-hover:#4f46e5;--color-primary-subtle:rgba(99,102,241,0.1);--color-accent:#8b5cf6;--color-success:#10b981;--color-danger:#ef4444;--surface-hover:rgba(0,0,0,0.04);--surface-active:rgba(99,102,241,0.12);--nav-width:72px;--radius-md:8px;--radius-lg:12px;--radius-xl:16px;width:92vw;max-width:1100px;height:85vh;max-height:750px;background:var(--modal-bg);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--modal-border);border-radius:var(--radius-xl);box-shadow:var(--modal-shadow);display:flex;flex-direction:row;overflow:hidden;margin:auto;font-family:\'Inter\',\'Outfit\',system-ui,-apple-system,sans-serif}.manager__nav[data-v-c6c4011c]{width:var(--nav-width);min-width:var(--nav-width);background:rgba(0,0,0,0.02);border-right:1px solid var(--modal-border);display:flex;flex-direction:column;align-items:center;padding:24px 0;gap:12px;flex-shrink:0}.manager__nav-item[data-v-c6c4011c]{width:48px;height:48px;border-radius:var(--radius-lg);border:none;background:transparent;color:var(--text-tertiary);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s cubic-bezier(0.4,0,0.2,1);position:relative}.manager__nav-item[data-v-c6c4011c]:hover:not(.manager__nav-item--active){background:var(--surface-hover);color:var(--text-primary)}.manager__nav-item--active[data-v-c6c4011c]{background:linear-gradient(135deg,var(--color-primary),var(--color-accent));color:#fff;box-shadow:0 4px 12px rgba(99,102,241,0.35);transform:translateY(-2px)}.manager__nav-item--active[data-v-c6c4011c]::after{content:\'\';position:absolute;inset:-3px;border-radius:15px;border:2px solid var(--modal-bg);opacity:0.4;z-index:-1}.manager__nav-icon[data-v-c6c4011c]{flex-shrink:0}.manager__main[data-v-c6c4011c]{flex:1;display:flex;flex-direction:column;min-width:0;overflow:hidden}.manager__header[data-v-c6c4011c]{display:flex;justify-content:space-between;align-items:center;padding:20px 28px;background:rgba(255,255,255,0.6);border-bottom:1px solid var(--modal-border);flex-shrink:0}.manager__title-group[data-v-c6c4011c]{display:flex;flex-direction:column;gap:4px}.manager__title[data-v-c6c4011c]{margin:0;font-size:1.4rem;font-weight:700;color:var(--text-primary);letter-spacing:-0.02em}.manager__subtitle[data-v-c6c4011c]{margin:0;font-size:0.85rem;color:var(--text-tertiary)}.manager__actions[data-v-c6c4011c]{display:flex;align-items:center;gap:10px}.manager__btn[data-v-c6c4011c]{display:flex;align-items:center;gap:6px;padding:10px 18px;border:none;border-radius:var(--radius-md);font-size:13px;font-weight:600;cursor:pointer;transition:all 0.2s ease}.manager__btn--primary[data-v-c6c4011c]{background:linear-gradient(135deg,var(--color-primary),var(--color-primary-hover));color:#fff;box-shadow:0 2px 8px rgba(99,102,241,0.3)}.manager__btn--primary[data-v-c6c4011c]:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(99,102,241,0.4)}.manager__btn--close[data-v-c6c4011c]{width:38px;height:38px;padding:0;background:var(--surface-hover);color:var(--text-tertiary);display:flex;align-items:center;justify-content:center;border-radius:50%}.manager__btn--close[data-v-c6c4011c]:hover{background:rgba(239,68,68,0.12);color:var(--color-danger)}.manager__content[data-v-c6c4011c]{flex:1;overflow:auto;padding:28px;background:linear-gradient(180deg,rgba(249,250,251,0.5) 0%,rgba(255,255,255,0) 100%)}.manager__placeholder[data-v-c6c4011c]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center}.manager__placeholder-icon[data-v-c6c4011c]{color:var(--color-primary);opacity:0.5;margin-bottom:20px}.manager__placeholder h2[data-v-c6c4011c]{margin:0 0 10px;font-size:1.6rem;font-weight:700;color:var(--text-primary)}.manager__placeholder-text[data-v-c6c4011c]{margin:0;color:var(--text-secondary);font-size:15px}.manager__placeholder-hint[data-v-c6c4011c]{margin:14px 0 0;color:var(--color-success);font-size:13px;font-weight:500}.manager__footer[data-v-c6c4011c]{display:flex;justify-content:space-between;padding:14px 28px;background:rgba(249,250,251,0.95);border-top:1px solid var(--modal-border);font-size:12px;color:var(--text-tertiary);flex-shrink:0}.manager__footer-status[data-v-c6c4011c]{color:var(--color-primary);font-weight:500}.manager__content[data-v-c6c4011c]::-webkit-scrollbar{width:6px}.manager__content[data-v-c6c4011c]::-webkit-scrollbar-track{background:transparent}.manager__content[data-v-c6c4011c]::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.12);border-radius:3px}.manager__content[data-v-c6c4011c]::-webkit-scrollbar-thumb:hover{background:rgba(0,0,0,0.2)}@media (max-width:640px){.manager[data-v-c6c4011c]{flex-direction:column-reverse;width:98vw;height:92vh}.manager__nav[data-v-c6c4011c]{width:100%;min-width:100%;height:auto;flex-direction:row;justify-content:space-around;padding:8px 12px;border-right:none;border-top:1px solid var(--modal-border);gap:0}.manager__nav-item[data-v-c6c4011c]{width:44px;height:44px}.manager__nav-item--active[data-v-c6c4011c]{transform:none}.manager__header[data-v-c6c4011c]{padding:16px 20px}.manager__title[data-v-c6c4011c]{font-size:1.2rem}.manager__content[data-v-c6c4011c]{padding:20px}}\n','',{version:3,sources:['webpack://./src/通用状态栏框架/components/manager/ManagerModal.vue'],names:[],mappings:'AA8HA,0BAEE,iCAAqC,CACrC,+BAAmC,CACnC,2CAA+C,CAE/C,sBAAuB,CACvB,wBAAyB,CACzB,uBAAwB,CAExB,uBAAwB,CACxB,6BAA8B,CAC9B,2CAA+C,CAC/C,sBAAuB,CACvB,uBAAwB,CACxB,sBAAuB,CAEvB,gCAAoC,CACpC,sCAA0C,CAE1C,gBAAiB,CACjB,eAAgB,CAChB,gBAAiB,CACjB,gBAAiB,CAGjB,UAAW,CACX,gBAAiB,CACjB,WAAY,CACZ,gBAAiB,CAEjB,0BAA2B,CAC3B,0BAA2B,CAC3B,kCAAmC,CACnC,oCAAqC,CACrC,8BAA+B,CAC/B,8BAA+B,CAE/B,YAAa,CACb,kBAAmB,CACnB,eAAgB,CAChB,WAAY,CAEZ,+DAMF,CAGA,+BACE,sBAAuB,CACvB,0BAA2B,CAC3B,2BAA+B,CAC/B,0CAA2C,CAC3C,YAAa,CACb,qBAAsB,CACtB,kBAAmB,CACnB,cAAe,CACf,QAAS,CACT,aACF,CAEA,oCACE,UAAW,CACX,WAAY,CACZ,8BAA+B,CAC/B,WAAY,CACZ,sBAAuB,CACvB,0BAA2B,CAC3B,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,cAAe,CACf,6CAAiD,CACjD,iBACF,CAEA,0EACE,+BAAgC,CAChC,yBACF,CAEA,4CACE,2EAA8E,CAC9E,UAAW,CACX,2CAA+C,CAC/C,0BACF,CAEA,mDACE,UAAW,CACX,iBAAkB,CAClB,UAAW,CACX,kBAAmB,CACnB,gCAAiC,CACjC,WAAY,CACZ,UACF,CAEA,oCACE,aACF,CAGA,gCACE,MAAO,CACP,YAAa,CACb,qBAAsB,CACtB,WAAY,CACZ,eACF,CAGA,kCACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,iBAAkB,CAClB,gCAAoC,CACpC,2CAA4C,CAC5C,aACF,CAEA,uCACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,iCACE,QAAS,CACT,gBAAiB,CACjB,eAAgB,CAChB,yBAA0B,CAC1B,sBACF,CAEA,oCACE,QAAS,CACT,iBAAkB,CAClB,0BACF,CAEA,mCACE,YAAa,CACb,kBAAmB,CACnB,QACF,CAGA,+BACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,iBAAkB,CAClB,WAAY,CACZ,8BAA+B,CAC/B,cAAe,CACf,eAAgB,CAChB,cAAe,CACf,wBACF,CAEA,wCACE,kFAAqF,CACrF,UAAW,CACX,yCACF,CAEA,8CACE,0BAA2B,CAC3B,0CACF,CAEA,sCACE,UAAW,CACX,WAAY,CACZ,SAAU,CACV,+BAAgC,CAChC,0BAA2B,CAC3B,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,iBACF,CAEA,4CACE,+BAAmC,CACnC,yBACF,CAGA,mCACE,MAAO,CACP,aAAc,CACd,YAAa,CACb,oFACF,CAEA,uCACE,YAAa,CACb,qBAAsB,CACtB,kBAAmB,CACnB,sBAAuB,CACvB,WAAY,CACZ,iBACF,CAEA,4CACE,0BAA2B,CAC3B,WAAY,CACZ,kBACF,CAEA,0CACE,eAAgB,CAChB,gBAAiB,CACjB,eAAgB,CAChB,yBACF,CAEA,4CACE,QAAS,CACT,2BAA4B,CAC5B,cACF,CAEA,4CACE,eAAgB,CAChB,0BAA2B,CAC3B,cAAe,CACf,eACF,CAGA,kCACE,YAAa,CACb,6BAA8B,CAC9B,iBAAkB,CAClB,iCAAqC,CACrC,wCAAyC,CACzC,cAAe,CACf,0BAA2B,CAC3B,aACF,CAEA,yCACE,0BAA2B,CAC3B,eACF,CAGA,sDACE,SACF,CAEA,4DACE,sBACF,CAEA,4DACE,2BAA+B,CAC/B,iBACF,CAEA,kEACE,0BACF,CAGA,yBACE,0BACE,6BAA8B,CAC9B,UAAW,CACX,WACF,CAEA,+BACE,UAAW,CACX,cAAe,CACf,WAAY,CACZ,kBAAmB,CACnB,4BAA6B,CAC7B,gBAAiB,CACjB,iBAAkB,CAClB,wCAAyC,CACzC,KACF,CAEA,oCACE,UAAW,CACX,WACF,CAEA,4CACE,cACF,CAEA,kCACE,iBACF,CAEA,iCACE,gBACF,CAEA,mCACE,YACF,CACF',sourcesContent:['<script setup lang="ts">\n/**\n * 管理器模态框 - 左侧导航布局版本\n *\n * 基于 AIStudioAPP 版 UI 参考的设计系统\n * 左侧图标导航栏 + 主内容区\n */\nimport { computed, ref } from \'vue\';\nimport DefinitionStudio from \'./modules/DefinitionStudio.vue\';\n\ntype ModuleKey = \'data\' | \'definitions\' | \'styles\' | \'layout\' | \'config\';\n\nconst activeModule = ref<ModuleKey>(\'data\');\n\nconst modules = [\n  { key: \'data\', name: \'数据中心\', icon: \'database\', desc: \'管理角色状态数据\' },\n  { key: \'definitions\', name: \'定义工坊\', icon: \'box\', desc: \'定义数据结构与元数据\' },\n  { key: \'styles\', name: \'样式工坊\', icon: \'paintbrush\', desc: \'创建可复用样式单元\' },\n  { key: \'layout\', name: \'布局编排\', icon: \'layout\', desc: \'可视化设计状态栏布局\' },\n  { key: \'config\', name: \'系统配置\', icon: \'settings\', desc: \'预设、快照与系统设置\' },\n] as const;\n\nconst currentModule = computed(() => modules.find(m => m.key === activeModule.value));\n\n// SVG 图标路径 (Lucide Icons 风格)\nconst iconPaths: Record<string, string> = {\n  // Database - 数据中心\n  database:\n    \'M12 2C6.48 2 2 4.69 2 8v8c0 3.31 4.48 6 10 6s10-2.69 10-6V8c0-3.31-4.48-6-10-6zm0 2c4.42 0 8 1.79 8 4s-3.58 4-8 4-8-1.79-8-4 3.58-4 8-4zm8 12c0 2.21-3.58 4-8 4s-8-1.79-8-4v-2.18c1.86 1.38 4.78 2.18 8 2.18s6.14-.8 8-2.18V16z\',\n  // Box - 定义工坊\n  box: \'M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.36.2-.74.18-1.14 0l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.36-.2.74-.18 1.14 0l7.9 4.44c.32.17.53.5.53.88v9zM12 4.15 5.04 8 12 11.85 18.96 8 12 4.15z\',\n  // Paintbrush - 样式工坊\n  paintbrush:\n    \'M20.71 4.63l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41zM7 14a3 3 0 0 0-3 3c0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2a4 4 0 0 0 4-4 3 3 0 0 0-3-3z\',\n  // Layout - 布局编排\n  layout:\n    \'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 7h4v4H7V7zm6 0h4v4h-4V7zM7 13h4v4H7v-4zm6 0h4v4h-4v-4z\',\n  // Settings - 系统配置\n  settings:\n    \'M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z\',\n  // Close\n  close: \'M18 6L6 18M6 6l12 12\',\n  // Save\n  save: \'M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z\',\n};\n\nfunction handleClose() {\n  // 事件需要发送到主窗口（Vue 组件虽然挂载在主窗口 DOM，但脚本运行在 iframe 中）\n  const targetDocument = (window.parent ?? window).document;\n  const event = new CustomEvent(\'th:manager-close\');\n  targetDocument.documentElement.dispatchEvent(event);\n}\n<\/script>\n\n<template>\n  <div class="manager" @click.stop>\n    \x3c!-- 左侧图标导航栏 --\x3e\n    <nav class="manager__nav">\n      <button\n        v-for="mod in modules"\n        :key="mod.key"\n        type="button"\n        class="manager__nav-item"\n        :class="{ \'manager__nav-item--active\': activeModule === mod.key }"\n        :title="mod.name"\n        @click="activeModule = mod.key"\n      >\n        <svg class="manager__nav-icon" viewBox="0 0 24 24" width="22" height="22">\n          <path :d="iconPaths[mod.icon]" fill="currentColor" />\n        </svg>\n      </button>\n    </nav>\n\n    \x3c!-- 主内容区 --\x3e\n    <div class="manager__main">\n      \x3c!-- 顶部标题栏 --\x3e\n      <header class="manager__header">\n        <div class="manager__title-group">\n          <h1 class="manager__title">{{ currentModule?.name }}</h1>\n          <p class="manager__subtitle">{{ currentModule?.desc }}</p>\n        </div>\n        <div class="manager__actions">\n          <button class="manager__btn manager__btn--primary" type="button">\n            <svg viewBox="0 0 24 24" width="16" height="16">\n              <path :d="iconPaths.save" fill="currentColor" />\n            </svg>\n            <span>保存</span>\n          </button>\n          <button class="manager__btn manager__btn--close" type="button" @click="handleClose">\n            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">\n              <path :d="iconPaths.close" />\n            </svg>\n          </button>\n        </div>\n      </header>\n\n      \x3c!-- 模块内容区 --\x3e\n      <main class="manager__content">\n        \x3c!-- 定义工坊 --\x3e\n        <DefinitionStudio v-if="activeModule === \'definitions\'" />\n\n        \x3c!-- 占位符 (其他模块开发中) --\x3e\n        <div v-else class="manager__placeholder">\n          <svg class="manager__placeholder-icon" viewBox="0 0 24 24" width="64" height="64">\n            <path :d="iconPaths[currentModule?.icon || \'database\']" fill="currentColor" />\n          </svg>\n          <h2>{{ currentModule?.name }}</h2>\n          <p class="manager__placeholder-text">此模块正在开发中...</p>\n          <p class="manager__placeholder-hint">框架已成功加载！后续将逐步完善各项功能</p>\n        </div>\n      </main>\n\n      \x3c!-- 底部状态栏 --\x3e\n      <footer class="manager__footer">\n        <span>通用状态栏框架 v0.1.0</span>\n        <span class="manager__footer-status">浅色模式 · 开发中</span>\n      </footer>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n/* ============================================\n   左侧导航布局 - 基于 AIStudioAPP 版设计系统\n   ============================================ */\n\n.manager {\n  /* CSS 变量 */\n  --modal-bg: rgba(255, 255, 255, 0.98);\n  --modal-border: rgba(0, 0, 0, 0.08);\n  --modal-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);\n\n  --text-primary: #1f2937;\n  --text-secondary: #6b7280;\n  --text-tertiary: #9ca3af;\n\n  --color-primary: #6366f1;\n  --color-primary-hover: #4f46e5;\n  --color-primary-subtle: rgba(99, 102, 241, 0.1);\n  --color-accent: #8b5cf6;\n  --color-success: #10b981;\n  --color-danger: #ef4444;\n\n  --surface-hover: rgba(0, 0, 0, 0.04);\n  --surface-active: rgba(99, 102, 241, 0.12);\n\n  --nav-width: 72px;\n  --radius-md: 8px;\n  --radius-lg: 12px;\n  --radius-xl: 16px;\n\n  /* 布局 */\n  width: 92vw;\n  max-width: 1100px;\n  height: 85vh;\n  max-height: 750px;\n\n  background: var(--modal-bg);\n  backdrop-filter: blur(24px);\n  -webkit-backdrop-filter: blur(24px);\n  border: 1px solid var(--modal-border);\n  border-radius: var(--radius-xl);\n  box-shadow: var(--modal-shadow);\n\n  display: flex;\n  flex-direction: row;\n  overflow: hidden;\n  margin: auto;\n\n  font-family:\n    \'Inter\',\n    \'Outfit\',\n    system-ui,\n    -apple-system,\n    sans-serif;\n}\n\n/* ====== 左侧导航栏 ====== */\n.manager__nav {\n  width: var(--nav-width);\n  min-width: var(--nav-width);\n  background: rgba(0, 0, 0, 0.02);\n  border-right: 1px solid var(--modal-border);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 24px 0;\n  gap: 12px;\n  flex-shrink: 0;\n}\n\n.manager__nav-item {\n  width: 48px;\n  height: 48px;\n  border-radius: var(--radius-lg);\n  border: none;\n  background: transparent;\n  color: var(--text-tertiary);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n  position: relative;\n}\n\n.manager__nav-item:hover:not(.manager__nav-item--active) {\n  background: var(--surface-hover);\n  color: var(--text-primary);\n}\n\n.manager__nav-item--active {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-accent));\n  color: #fff;\n  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.35);\n  transform: translateY(-2px);\n}\n\n.manager__nav-item--active::after {\n  content: \'\';\n  position: absolute;\n  inset: -3px;\n  border-radius: 15px;\n  border: 2px solid var(--modal-bg);\n  opacity: 0.4;\n  z-index: -1;\n}\n\n.manager__nav-icon {\n  flex-shrink: 0;\n}\n\n/* ====== 主内容区 ====== */\n.manager__main {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-width: 0;\n  overflow: hidden;\n}\n\n/* 顶部标题栏 */\n.manager__header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 20px 28px;\n  background: rgba(255, 255, 255, 0.6);\n  border-bottom: 1px solid var(--modal-border);\n  flex-shrink: 0;\n}\n\n.manager__title-group {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.manager__title {\n  margin: 0;\n  font-size: 1.4rem;\n  font-weight: 700;\n  color: var(--text-primary);\n  letter-spacing: -0.02em;\n}\n\n.manager__subtitle {\n  margin: 0;\n  font-size: 0.85rem;\n  color: var(--text-tertiary);\n}\n\n.manager__actions {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n/* 按钮 */\n.manager__btn {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 10px 18px;\n  border: none;\n  border-radius: var(--radius-md);\n  font-size: 13px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.manager__btn--primary {\n  background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));\n  color: #fff;\n  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);\n}\n\n.manager__btn--primary:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 4px 14px rgba(99, 102, 241, 0.4);\n}\n\n.manager__btn--close {\n  width: 38px;\n  height: 38px;\n  padding: 0;\n  background: var(--surface-hover);\n  color: var(--text-tertiary);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 50%;\n}\n\n.manager__btn--close:hover {\n  background: rgba(239, 68, 68, 0.12);\n  color: var(--color-danger);\n}\n\n/* 内容区 */\n.manager__content {\n  flex: 1;\n  overflow: auto;\n  padding: 28px;\n  background: linear-gradient(180deg, rgba(249, 250, 251, 0.5) 0%, rgba(255, 255, 255, 0) 100%);\n}\n\n.manager__placeholder {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n  text-align: center;\n}\n\n.manager__placeholder-icon {\n  color: var(--color-primary);\n  opacity: 0.5;\n  margin-bottom: 20px;\n}\n\n.manager__placeholder h2 {\n  margin: 0 0 10px;\n  font-size: 1.6rem;\n  font-weight: 700;\n  color: var(--text-primary);\n}\n\n.manager__placeholder-text {\n  margin: 0;\n  color: var(--text-secondary);\n  font-size: 15px;\n}\n\n.manager__placeholder-hint {\n  margin: 14px 0 0;\n  color: var(--color-success);\n  font-size: 13px;\n  font-weight: 500;\n}\n\n/* 底部状态栏 */\n.manager__footer {\n  display: flex;\n  justify-content: space-between;\n  padding: 14px 28px;\n  background: rgba(249, 250, 251, 0.95);\n  border-top: 1px solid var(--modal-border);\n  font-size: 12px;\n  color: var(--text-tertiary);\n  flex-shrink: 0;\n}\n\n.manager__footer-status {\n  color: var(--color-primary);\n  font-weight: 500;\n}\n\n/* 滚动条 */\n.manager__content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.manager__content::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.manager__content::-webkit-scrollbar-thumb {\n  background: rgba(0, 0, 0, 0.12);\n  border-radius: 3px;\n}\n\n.manager__content::-webkit-scrollbar-thumb:hover {\n  background: rgba(0, 0, 0, 0.2);\n}\n\n/* 响应式：小屏幕改为底部导航 */\n@media (max-width: 640px) {\n  .manager {\n    flex-direction: column-reverse;\n    width: 98vw;\n    height: 92vh;\n  }\n\n  .manager__nav {\n    width: 100%;\n    min-width: 100%;\n    height: auto;\n    flex-direction: row;\n    justify-content: space-around;\n    padding: 8px 12px;\n    border-right: none;\n    border-top: 1px solid var(--modal-border);\n    gap: 0;\n  }\n\n  .manager__nav-item {\n    width: 44px;\n    height: 44px;\n  }\n\n  .manager__nav-item--active {\n    transform: none;\n  }\n\n  .manager__header {\n    padding: 16px 20px;\n  }\n\n  .manager__title {\n    font-size: 1.2rem;\n  }\n\n  .manager__content {\n    padding: 20px;\n  }\n}\n</style>\n'],sourceRoot:''}]);const s=i},670(e,t,n){n.r(t),n.d(t,{default:()=>s});var a=n(699),r=n.n(a),o=n(465),i=n.n(o)()(r());i.push([e.id,'.status-bar[data-v-0aa8f2f0]{--bar-bg:rgba(255,255,255,0.92);--bar-border:rgba(0,0,0,0.08);--bar-shadow:0 4px 16px rgba(0,0,0,0.08);--text-primary:#1f2937;--text-secondary:#6b7280;--text-tertiary:#9ca3af;--color-primary:#6366f1;--color-success:#10b981;font-family:\'Outfit\',\'Inter\',system-ui,-apple-system,sans-serif;font-size:14px;color:var(--text-primary);background:var(--bar-bg);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--bar-border);border-radius:12px;padding:14px 16px;margin-top:12px;box-shadow:var(--bar-shadow)}.status-bar__header[data-v-0aa8f2f0]{display:flex;align-items:center;gap:10px;padding-bottom:12px;margin-bottom:12px;border-bottom:1px solid var(--bar-border)}.status-bar__icon[data-v-0aa8f2f0]{color:var(--color-primary);flex-shrink:0}.status-bar__title[data-v-0aa8f2f0]{font-weight:600;font-size:15px;color:var(--text-primary)}.status-bar__streaming[data-v-0aa8f2f0]{margin-left:auto;font-size:11px;font-weight:500;padding:3px 10px;background:rgba(16,185,129,0.12);color:var(--color-success);border-radius:12px;animation:pulse-0aa8f2f0 1.5s ease-in-out infinite}@keyframes pulse-0aa8f2f0{0%,100%{opacity:1}50%{opacity:0.5}}.status-bar__content[data-v-0aa8f2f0]{display:flex;flex-direction:column;gap:8px}.status-bar__placeholder[data-v-0aa8f2f0]{display:flex;flex-direction:column;align-items:center;gap:8px;padding:20px;color:var(--text-secondary);text-align:center}.status-bar__hint[data-v-0aa8f2f0]{font-size:12px;color:var(--text-tertiary)}\n','',{version:3,sources:['webpack://./src/通用状态栏框架/components/statusbar/StatusBar.vue'],names:[],mappings:'AAqCA,6BACE,+BAAmC,CACnC,6BAAiC,CACjC,wCAA4C,CAE5C,sBAAuB,CACvB,wBAAyB,CACzB,uBAAwB,CAExB,uBAAwB,CACxB,uBAAwB,CAExB,+DAKY,CACZ,cAAe,CACf,yBAA0B,CAC1B,wBAAyB,CACzB,0BAA2B,CAC3B,kCAAmC,CACnC,kCAAmC,CACnC,kBAAmB,CACnB,iBAAkB,CAClB,eAAgB,CAChB,4BACF,CAEA,qCACE,YAAa,CACb,kBAAmB,CACnB,QAAS,CACT,mBAAoB,CACpB,kBAAmB,CACnB,yCACF,CAEA,mCACE,0BAA2B,CAC3B,aACF,CAEA,oCACE,eAAgB,CAChB,cAAe,CACf,yBACF,CAEA,wCACE,gBAAiB,CACjB,cAAe,CACf,eAAgB,CAChB,gBAAiB,CACjB,gCAAoC,CACpC,0BAA2B,CAC3B,kBAAmB,CACnB,kDACF,CAEA,0BACE,QAEE,SACF,CACA,IACE,WACF,CACF,CAEA,sCACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,0CACE,YAAa,CACb,qBAAsB,CACtB,kBAAmB,CACnB,OAAQ,CACR,YAAa,CACb,2BAA4B,CAC5B,iBACF,CAEA,mCACE,cAAe,CACf,0BACF',sourcesContent:['<script setup lang="ts">\n/**\n * 状态栏组件 - 浅色模式版本\n * 显示在每个 AI 消息楼层下方\n */\nimport { injectStreamingMessageContext } from \'@util/streaming\';\n\nconst ctx = injectStreamingMessageContext();\n\n// SVG 图标路径\nconst databaseIcon =\n  \'M12 2C6.48 2 2 4.69 2 8v8c0 3.31 4.48 6 10 6s10-2.69 10-6V8c0-3.31-4.48-6-10-6zm0 2c4.42 0 8 1.79 8 4s-3.58 4-8 4-8-1.79-8-4 3.58-4 8-4zm8 12c0 2.21-3.58 4-8 4s-8-1.79-8-4v-2.18c1.86 1.38 4.78 2.18 8 2.18s6.14-.8 8-2.18V16z\';\n<\/script>\n\n<template>\n  <div class="status-bar">\n    <div class="status-bar__header">\n      <svg class="status-bar__icon" viewBox="0 0 24 24" width="18" height="18">\n        <path :d="databaseIcon" fill="currentColor" />\n      </svg>\n      <span class="status-bar__title">通用状态栏</span>\n      <span v-if="ctx.during_streaming" class="status-bar__streaming">生成中...</span>\n    </div>\n    <div class="status-bar__content">\n      <div class="status-bar__placeholder">\n        <span>暂无状态数据</span>\n        <span class="status-bar__hint">点击扩展菜单中的「通用状态栏管理器」添加定义</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n/* ============================================\n   浅色模式状态栏 - 玻璃拟态风格\n   ============================================ */\n\n.status-bar {\n  --bar-bg: rgba(255, 255, 255, 0.92);\n  --bar-border: rgba(0, 0, 0, 0.08);\n  --bar-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n\n  --text-primary: #1f2937;\n  --text-secondary: #6b7280;\n  --text-tertiary: #9ca3af;\n\n  --color-primary: #6366f1;\n  --color-success: #10b981;\n\n  font-family:\n    \'Outfit\',\n    \'Inter\',\n    system-ui,\n    -apple-system,\n    sans-serif;\n  font-size: 14px;\n  color: var(--text-primary);\n  background: var(--bar-bg);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid var(--bar-border);\n  border-radius: 12px;\n  padding: 14px 16px;\n  margin-top: 12px;\n  box-shadow: var(--bar-shadow);\n}\n\n.status-bar__header {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  padding-bottom: 12px;\n  margin-bottom: 12px;\n  border-bottom: 1px solid var(--bar-border);\n}\n\n.status-bar__icon {\n  color: var(--color-primary);\n  flex-shrink: 0;\n}\n\n.status-bar__title {\n  font-weight: 600;\n  font-size: 15px;\n  color: var(--text-primary);\n}\n\n.status-bar__streaming {\n  margin-left: auto;\n  font-size: 11px;\n  font-weight: 500;\n  padding: 3px 10px;\n  background: rgba(16, 185, 129, 0.12);\n  color: var(--color-success);\n  border-radius: 12px;\n  animation: pulse 1.5s ease-in-out infinite;\n}\n\n@keyframes pulse {\n  0%,\n  100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n\n.status-bar__content {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.status-bar__placeholder {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 8px;\n  padding: 20px;\n  color: var(--text-secondary);\n  text-align: center;\n}\n\n.status-bar__hint {\n  font-size: 12px;\n  color: var(--text-tertiary);\n}\n</style>\n'],sourceRoot:''}]);const s=i},699(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),o='/*# '.concat(r,' */');return[t].concat([o]).join('\n')}return[t].join('\n')}},889(e,t){t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={id:a,exports:{}};return e[a](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};function a(e='head'){const t=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone()).appendTo(e);return{destroy:()=>t.remove()}}function r(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){const t=16*Math.random()|0;return('x'===e?t:3&t|8).toString(16)})}const o=Vue;function i(e,t={}){const{host:n='iframe',filter:i,prefix:s=r()}=t,l=new Map;let d=!1;const c=e=>{const t=Number($('#chat > .mes').first().attr('mesid'));return!_.inRange(e,t,SillyTavern.chat.length)&&(l.get(e)?.destroy(),!0)},A=()=>{l.keys().forEach(e=>c(e))},p=async(t,r)=>{if(d)return;if(c(t))return;const A=r??getChatMessages(t)[0].message??'';if(i&&!i(t,A))return void l.get(t)?.destroy();const p=$(`.mes[mesid='${t}']`),C=p.find('.mes_text').addClass('hidden!');p.find('.TH-streaming').addClass('hidden!');let m=p.find(`#${s}-${t}`);if(m.length>0){const e=l.get(t);if(e)return e.data.message=A,void(e.data.during_streaming=Boolean(r))}l.get(t)?.destroy(),m.remove();let u=p.find('.mes_streaming');0===u.length&&(u=$('<div class="mes_streaming">').css({'font-weight':'500','line-height':'calc(var(--mainFontSize) + .5rem)','max-width':'100%','overflow-wrap':'anywhere',padding:'calc(var(--mainFontSize) * 0.8) 0 0 0'}).insertAfter(C)),m=('iframe'===n?$('<iframe>').attr({script_id:getScriptId(),frameborder:0,srcdoc:'<!DOCTYPE html> <html> <head> <link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"> <script src="https://testingcf.jsdelivr.net/gh/n0vi028/JS-Slash-Runner/lib/tailwindcss.min.js"><\/script> <script src="https://testingcf.jsdelivr.net/npm/jquery"><\/script> <script src="https://testingcf.jsdelivr.net/npm/jquery-ui/dist/jquery-ui.min.js"><\/script> <link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/jquery-ui/themes/base/theme.min.css"/> <script src="https://testingcf.jsdelivr.net/npm/jquery-ui-touch-punch"><\/script> <script src="https://testingcf.jsdelivr.net/npm/lodash"><\/script> <script src="https://testingcf.jsdelivr.net/gh/n0vi028/JS-Slash-Runner/src/iframe/adjust_iframe_height.js"><\/script> <style>*,::after,::before{box-sizing:border-box}body,html{margin:0!important;padding:0;overflow:hidden!important;max-width:100%!important}</style> </head> <html> </html></html>'}).addClass('w-full'):$('<div>').attr('script_id',getScriptId())).attr('id',`${s}-${t}`).appendTo(u);const g=(0,o.reactive)({prefix:s,host_id:`${s}-${t}`,message_id:t,message:A,during_streaming:Boolean(r)}),v=e().provide('streaming_message_context',g);'iframe'===n?m.on('load',function(){a(this.contentDocument.head),v.mount(this.contentDocument.body)}):v.mount(m[0]);const b=new MutationObserver(()=>{const e=$('#chat').find('#curEditTextarea');e.parent().is(C)?(C.removeClass('hidden!'),m.addClass('hidden!')):0===e.length&&(C.addClass('hidden!'),p.find('.TH-streaming').addClass('hidden!'),m.removeClass('hidden!'))});b.observe(C[0],{childList:!0}),l.set(t,{app:v,data:g,destroy:()=>{const e=p.find('.TH-streaming');e.length>0?e.removeClass('hidden!'):C.removeClass('hidden!'),v.unmount(),m.remove(),0===u.children().length&&u.remove(),b.disconnect(),l.delete(t)}})},C=async(e={})=>{d||(e.destroy_all?l.forEach(({destroy:e})=>e()):A(),await Promise.all($('#chat').children('.mes[is_user=\'false\'][is_system=\'false\']').map(async(t,n)=>{const a=Number($(n).attr('mesid')??'NaN');isNaN(a)||(await p(a),e.trigger_event&&eventEmit(tavern_events.CHARACTER_MESSAGE_RENDERED,a,'rerender'))})))},m=[],u=(e,t,n)=>{m.push(n?eventMakeFirst(e,errorCatched(t)).stop:eventOn(e,errorCatched(t)).stop)};return u('chatLoaded',()=>{C({destroy_all:!0})}),u(tavern_events.CHARACTER_MESSAGE_RENDERED,e=>{A(),p(e)},!0),[tavern_events.MESSAGE_EDITED,tavern_events.MESSAGE_DELETED].forEach(e=>u(e,e=>{A(),l.get(e)?.destroy(),p(e)})),[tavern_events.MORE_MESSAGES_LOADED,tavern_events.MESSAGE_DELETED].forEach(e=>u(e,()=>setTimeout(errorCatched(C),1e3))),u(tavern_events.STREAM_TOKEN_RECEIVED,e=>{p(Number($('#chat').children('.mes.last_mes').attr('mesid')),e)}),'div'===n&&m.push(a().destroy),C({trigger_event:!0}),{unmount:()=>{const e=$('#chat').find('.TH-streaming');e.length>0?e.removeClass('hidden!'):$('chat').find('.mes_text').removeClass('hidden!'),l.forEach(({destroy:e})=>e()),m.forEach(e=>e()),d=!0}}}const s={class:'definition-studio'},l={class:'studio__sidebar-header'},d={viewBox:'0 0 24 24',width:'18',height:'18',fill:'none',stroke:'currentColor','stroke-width':'2'},c=['d'],A={class:'studio__sidebar-content'},p={viewBox:'0 0 24 24',width:'16',height:'16',fill:'currentColor'},C=['d'],m={class:'studio__category-count'},u=['onClick'],g={viewBox:'0 0 24 24',width:'16',height:'16',fill:'currentColor'},v=['d'],b={class:'studio__category-actions'},f=['onClick'],h={viewBox:'0 0 24 24',width:'14',height:'14',fill:'none',stroke:'currentColor','stroke-width':'2'},x=['d'],y=['onClick'],B={viewBox:'0 0 24 24',width:'14',height:'14',fill:'none',stroke:'currentColor','stroke-width':'2'},k=['d'],E={class:'studio__main'},w={class:'studio__toolbar'},V={class:'studio__section-title'},N={class:'studio__item-count'},F={class:'studio__toolbar-actions'},M={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},D=['d'],S={class:'studio__items-grid'},j=['onClick'],Y={class:'studio__item-header'},T={class:'studio__item-key'},I={class:'studio__item-name'},P={class:'studio__item-parts'},U={class:'studio__item-format'},O={class:'studio__item-actions'},W=['onClick'],q={viewBox:'0 0 24 24',width:'14',height:'14',fill:'none',stroke:'currentColor','stroke-width':'2'},R=['d'],H={key:0,class:'studio__empty'},L={viewBox:'0 0 24 24',width:'48',height:'48',fill:'none',stroke:'currentColor','stroke-width':'1.5'},G=['d'],Q={class:'studio__drawer-header'},Z={viewBox:'0 0 24 24',width:'20',height:'20',fill:'none',stroke:'currentColor','stroke-width':'2'},K=['d'],X={class:'studio__drawer-content'},J={class:'studio__form-group'},ee={class:'studio__form-group'},te={class:'studio__form-group'},ne={class:'studio__radio-group'},ae={class:'studio__radio'},re={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},oe=['d'],ie={class:'studio__radio'},se={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},le=['d'],de={class:'studio__form-group'},ce={class:'studio__drawer-footer'},Ae={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},pe=['d'],Ce={class:'studio__drawer-header'},me={viewBox:'0 0 24 24',width:'20',height:'20',fill:'none',stroke:'currentColor','stroke-width':'2'},ue=['d'],ge={class:'studio__drawer-content'},ve={class:'studio__form-row'},_e={class:'studio__form-group'},be={class:'studio__form-group'},fe={class:'studio__form-row'},he={class:'studio__form-group'},xe=['value'],ye={class:'studio__form-group'},Be={class:'studio__radio-group'},ke={class:'studio__radio'},Ee={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},we=['d'],Ve={class:'studio__radio'},Ne={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},Fe=['d'],Me={class:'studio__form-row'},De={class:'studio__form-group studio__form-group--small'},ze={key:0,class:'studio__form-group studio__form-group--small'},Se={class:'studio__form-group'},je={class:'studio__parts-header'},Ye={viewBox:'0 0 24 24',width:'14',height:'14',fill:'none',stroke:'currentColor','stroke-width':'2'},Te=['d'],Ie={class:'studio__parts-list'},Pe=['onUpdate:modelValue'],Ue=['onUpdate:modelValue'],Oe=['onUpdate:modelValue'],$e={class:'studio__part-actions'},We=['disabled','onClick'],qe={viewBox:'0 0 24 24',width:'14',height:'14',fill:'none',stroke:'currentColor','stroke-width':'2'},Re=['d'],He=['disabled','onClick'],Le={viewBox:'0 0 24 24',width:'14',height:'14',fill:'none',stroke:'currentColor','stroke-width':'2'},Ge=['d'],Qe=['onClick'],Ze={viewBox:'0 0 24 24',width:'14',height:'14',fill:'none',stroke:'currentColor','stroke-width':'2'},Ke=['d'],Xe={class:'studio__form-group'},Je={class:'studio__form-group'},et={class:'studio__format-preview'},tt={class:'studio__drawer-footer'},nt={class:'studio__btn studio__btn--secondary'},at={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},rt=['d'],ot={viewBox:'0 0 24 24',width:'16',height:'16',fill:'none',stroke:'currentColor','stroke-width':'2'},it=['d'],st=(0,o.defineComponent)({__name:'DefinitionStudio',setup(e){const t=(0,o.ref)({}),n=(0,o.ref)({}),a=(0,o.ref)(null),r=(0,o.ref)(!1),i=(0,o.ref)(!1),st=(0,o.ref)(!1),lt=(0,o.reactive)({key:'',name:'',icon:'folder',order:0,scope:'character'}),dt=(0,o.reactive)({key:'',name:'',icon:'',category:'',entry_type:'Single',parts:[],separator:'|',secondary_separator:'@',description:''}),ct=(0,o.computed)(()=>Object.values(t.value).sort((e,t)=>e.order-t.order)),At=(0,o.computed)(()=>{const e=Object.values(n.value);return a.value?e.filter(e=>e.category===a.value):e}),pt=(0,o.computed)(()=>a.value?t.value[a.value]:null),Ct=(0,o.computed)(()=>{if(!dt.key||!dt.category)return'';const e=t.value[dt.category],n='shared'===e?.scope?'ST':'{角色}',a=dt.category;let r='';if(0===dt.parts.length)r=`{${dt.key}}`;else if('Single'===dt.entry_type)r=dt.parts.map(e=>`{${e.key}}`).join(dt.separator);else{r=`${dt.parts.length>1?dt.parts.map(e=>`{${e.key}}`).join(dt.secondary_separator||'@'):`{${dt.parts[0]?.key||'item'}}`}${dt.separator}...`}return`[${n}^${a}|${dt.key}::${r}]`});function mt(){Object.assign(lt,{key:'',name:'',icon:'folder',order:ct.value.length,scope:'character'}),i.value=!0}function ut(){lt.key.trim()&&lt.name.trim()&&(t.value[lt.key]={...lt},i.value=!1)}function gt(){Object.assign(dt,{key:'',name:'',icon:'',category:a.value||'',entry_type:'Single',parts:[{key:'value',label:'值',data_type:'string'}],separator:'|',secondary_separator:'@',description:''}),st.value=!0}function vt(){dt.key.trim()&&dt.name.trim()&&(dt.format=Ct.value,n.value[dt.key]={...dt,parts:dt.parts.map(e=>({...e}))},st.value=!1)}function _t(){dt.parts.push({key:'',label:'',data_type:'string'})}function bt(e,t){const n=e+t;if(n<0||n>=dt.parts.length)return;const a=dt.parts[e];dt.parts[e]=dt.parts[n],dt.parts[n]=a}const ft='M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z',ht='M12 5v14M5 12h14',xt='M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z',yt='M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2',Bt='M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2zM17 21v-8H7v8M7 3v5h8',kt='M18 6L6 18M6 6l12 12',Et='M18 15l-6-6-6 6',wt='M6 9l6 6 6-6',Vt='M12 2C6.48 2 2 4.69 2 8v8c0 3.31 4.48 6 10 6s10-2.69 10-6V8c0-3.31-4.48-6-10-6zm0 2c4.42 0 8 1.79 8 4s-3.58 4-8 4-8-1.79-8-4 3.58-4 8-4z',Nt='M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z',Ft='M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01',Mt='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z',Dt='M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z',zt='M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12';return(e,St)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',s,[(0,o.createCommentVNode)(' 左侧分类列表 '),(0,o.createElementVNode)('aside',{class:(0,o.normalizeClass)(['studio__sidebar',{'studio__sidebar--collapsed':r.value}])},[(0,o.createElementVNode)('div',l,[St[22]||(St[22]=(0,o.createElementVNode)('span',{class:'studio__sidebar-title'},'分类列表',-1)),(0,o.createElementVNode)('button',{class:'studio__icon-btn',title:'新建分类',onClick:mt},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',d,[(0,o.createElementVNode)('path',{d:ht},null,8,c)]))])]),(0,o.createElementVNode)('div',A,[(0,o.createCommentVNode)(' 全部 '),(0,o.createElementVNode)('button',{class:(0,o.normalizeClass)(['studio__category-item',{'studio__category-item--active':null===a.value}]),onClick:St[0]||(St[0]=e=>a.value=null)},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',p,[(0,o.createElementVNode)('path',{d:Vt},null,8,C)])),St[23]||(St[23]=(0,o.createElementVNode)('span',null,'全部条目',-1)),(0,o.createElementVNode)('span',m,(0,o.toDisplayString)(Object.keys(n.value).length),1)],2),(0,o.createCommentVNode)(' 分类列表 '),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(ct.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('button',{key:e.key,class:(0,o.normalizeClass)(['studio__category-item',{'studio__category-item--active':a.value===e.key}]),onClick:t=>a.value=e.key},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',g,[(0,o.createElementVNode)('path',{d:ft},null,8,v)])),(0,o.createElementVNode)('span',null,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['studio__category-badge','shared'===e.scope?'studio__category-badge--shared':''])},(0,o.toDisplayString)('shared'===e.scope?'共享':'角色'),3),(0,o.createElementVNode)('div',b,[(0,o.createElementVNode)('button',{class:'studio__mini-btn',title:'编辑',onClick:(0,o.withModifiers)(t=>function(e){Object.assign(lt,{...e}),i.value=!0}(e),['stop'])},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',h,[(0,o.createElementVNode)('path',{d:xt},null,8,x)]))],8,f),(0,o.createElementVNode)('button',{class:'studio__mini-btn studio__mini-btn--danger',title:'删除',onClick:(0,o.withModifiers)(n=>{return r=e.key,void(confirm(`确定删除分类 "${t.value[r]?.name}"？\n注意：不会删除属于该分类的条目定义。`)&&(delete t.value[r],a.value===r&&(a.value=null)));var r},['stop'])},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',B,[(0,o.createElementVNode)('path',{d:yt},null,8,k)]))],8,y)])],10,u))),128))])],2),(0,o.createCommentVNode)(' 主内容区 '),(0,o.createElementVNode)('main',E,[(0,o.createCommentVNode)(' 工具栏 '),(0,o.createElementVNode)('div',w,[(0,o.createElementVNode)('h2',V,[(0,o.createTextVNode)((0,o.toDisplayString)(pt.value?pt.value.name:'全部条目')+' ',1),(0,o.createElementVNode)('span',N,'('+(0,o.toDisplayString)(At.value.length)+' 项)',1)]),(0,o.createElementVNode)('div',F,[(0,o.createElementVNode)('button',{class:'studio__btn studio__btn--primary',onClick:gt},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',M,[(0,o.createElementVNode)('path',{d:ht},null,8,D)])),St[24]||(St[24]=(0,o.createTextVNode)(' 新建条目 ',-1))])])]),(0,o.createCommentVNode)(' 条目列表 '),(0,o.createElementVNode)('div',S,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(At.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:e.key,class:'studio__item-card',onClick:t=>function(e){Object.assign(dt,{...e,parts:e.parts.map(e=>({...e}))}),st.value=!0}(e)},[(0,o.createElementVNode)('div',Y,[(0,o.createElementVNode)('span',T,(0,o.toDisplayString)(e.key),1),(0,o.createElementVNode)('span',{class:(0,o.normalizeClass)(['studio__item-type','List'===e.entry_type?'studio__item-type--list':''])},(0,o.toDisplayString)(e.entry_type),3)]),(0,o.createElementVNode)('div',I,(0,o.toDisplayString)(e.name),1),(0,o.createElementVNode)('div',P,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(e.parts,e=>((0,o.openBlock)(),(0,o.createElementBlock)('span',{key:e.key,class:'studio__part-tag'},(0,o.toDisplayString)(e.label),1))),128))]),(0,o.createElementVNode)('div',U,(0,o.toDisplayString)(e.format),1),(0,o.createElementVNode)('div',O,[(0,o.createElementVNode)('button',{class:'studio__mini-btn studio__mini-btn--danger',title:'删除',onClick:(0,o.withModifiers)(t=>{return a=e.key,void(confirm(`确定删除条目定义 "${n.value[a]?.name}"？`)&&delete n.value[a]);var a},['stop'])},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',q,[(0,o.createElementVNode)('path',{d:yt},null,8,R)]))],8,W)])],8,j))),128)),(0,o.createCommentVNode)(' 空状态 '),0===At.value.length?((0,o.openBlock)(),(0,o.createElementBlock)('div',H,[((0,o.openBlock)(),(0,o.createElementBlock)('svg',L,[(0,o.createElementVNode)('path',{d:Nt},null,8,G)])),St[25]||(St[25]=(0,o.createElementVNode)('p',null,'暂无条目定义',-1)),(0,o.createElementVNode)('button',{class:'studio__btn studio__btn--primary',onClick:gt},'创建第一个条目')])):(0,o.createCommentVNode)('v-if',!0)])]),(0,o.createCommentVNode)(' 分类编辑抽屉 '),((0,o.openBlock)(),(0,o.createBlock)(o.Teleport,{to:'body'},[i.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'studio__drawer-overlay',onClick:St[9]||(St[9]=e=>i.value=!1)},[(0,o.createElementVNode)('div',{class:'studio__drawer',onClick:St[8]||(St[8]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',Q,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(lt.key?'编辑分类':'新建分类'),1),(0,o.createElementVNode)('button',{class:'studio__icon-btn',onClick:St[1]||(St[1]=e=>i.value=!1)},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',Z,[(0,o.createElementVNode)('path',{d:kt},null,8,K)]))])]),(0,o.createElementVNode)('div',X,[(0,o.createElementVNode)('div',J,[St[26]||(St[26]=(0,o.createElementVNode)('label',null,'唯一键 (Key)',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[2]||(St[2]=e=>lt.key=e),type:'text',placeholder:'如: CV, CP'},null,512),[[o.vModelText,lt.key]])]),(0,o.createElementVNode)('div',ee,[St[27]||(St[27]=(0,o.createElementVNode)('label',null,'显示名称',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[3]||(St[3]=e=>lt.name=e),type:'text',placeholder:'如: 角色属性'},null,512),[[o.vModelText,lt.name]])]),(0,o.createElementVNode)('div',te,[St[30]||(St[30]=(0,o.createElementVNode)('label',null,'作用域',-1)),(0,o.createElementVNode)('div',ne,[(0,o.createElementVNode)('label',ae,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[4]||(St[4]=e=>lt.scope=e),type:'radio',value:'character'},null,512),[[o.vModelRadio,lt.scope]]),((0,o.openBlock)(),(0,o.createElementBlock)('svg',re,[(0,o.createElementVNode)('path',{d:Mt},null,8,oe)])),St[28]||(St[28]=(0,o.createTextVNode)(' 角色数据 ',-1))]),(0,o.createElementVNode)('label',ie,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[5]||(St[5]=e=>lt.scope=e),type:'radio',value:'shared'},null,512),[[o.vModelRadio,lt.scope]]),((0,o.openBlock)(),(0,o.createElementBlock)('svg',se,[(0,o.createElementVNode)('path',{d:Dt},null,8,le)])),St[29]||(St[29]=(0,o.createTextVNode)(' 共享数据 ',-1))])])]),(0,o.createElementVNode)('div',de,[St[31]||(St[31]=(0,o.createElementVNode)('label',null,'排序权重',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[6]||(St[6]=e=>lt.order=e),type:'number',min:'0'},null,512),[[o.vModelText,lt.order,void 0,{number:!0}]])])]),(0,o.createElementVNode)('div',ce,[(0,o.createElementVNode)('button',{class:'studio__btn',onClick:St[7]||(St[7]=e=>i.value=!1)},'取消'),(0,o.createElementVNode)('button',{class:'studio__btn studio__btn--primary',onClick:ut},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',Ae,[(0,o.createElementVNode)('path',{d:Bt},null,8,pe)])),St[32]||(St[32]=(0,o.createTextVNode)(' 保存 ',-1))])])])])):(0,o.createCommentVNode)('v-if',!0)])),(0,o.createCommentVNode)(' 条目编辑抽屉 '),((0,o.openBlock)(),(0,o.createBlock)(o.Teleport,{to:'body'},[st.value?((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:0,class:'studio__drawer-overlay',onClick:St[21]||(St[21]=e=>st.value=!1)},[(0,o.createElementVNode)('div',{class:'studio__drawer studio__drawer--wide',onClick:St[20]||(St[20]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createElementVNode)('div',Ce,[(0,o.createElementVNode)('h3',null,(0,o.toDisplayString)(dt.key?'编辑条目':'新建条目'),1),(0,o.createElementVNode)('button',{class:'studio__icon-btn',onClick:St[10]||(St[10]=e=>st.value=!1)},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',me,[(0,o.createElementVNode)('path',{d:kt},null,8,ue)]))])]),(0,o.createElementVNode)('div',ge,[(0,o.createCommentVNode)(' 基础信息 '),(0,o.createElementVNode)('div',ve,[(0,o.createElementVNode)('div',_e,[St[33]||(St[33]=(0,o.createElementVNode)('label',null,'唯一键 (Key) *',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[11]||(St[11]=e=>dt.key=e),type:'text',placeholder:'如: HP, 背包'},null,512),[[o.vModelText,dt.key]])]),(0,o.createElementVNode)('div',be,[St[34]||(St[34]=(0,o.createElementVNode)('label',null,'显示名称 *',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[12]||(St[12]=e=>dt.name=e),type:'text',placeholder:'如: 生命值'},null,512),[[o.vModelText,dt.name]])])]),(0,o.createElementVNode)('div',fe,[(0,o.createElementVNode)('div',he,[St[36]||(St[36]=(0,o.createElementVNode)('label',null,'所属分类',-1)),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':St[13]||(St[13]=e=>dt.category=e)},[St[35]||(St[35]=(0,o.createElementVNode)('option',{value:''},'-- 选择分类 --',-1)),((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(ct.value,e=>((0,o.openBlock)(),(0,o.createElementBlock)('option',{key:e.key,value:e.key},(0,o.toDisplayString)(e.name)+' ('+(0,o.toDisplayString)(e.key)+') ',9,xe))),128))],512),[[o.vModelSelect,dt.category]])]),(0,o.createElementVNode)('div',ye,[St[39]||(St[39]=(0,o.createElementVNode)('label',null,'条目类型 (entry_type)',-1)),(0,o.createElementVNode)('div',Be,[(0,o.createElementVNode)('label',ke,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[14]||(St[14]=e=>dt.entry_type=e),type:'radio',value:'Single'},null,512),[[o.vModelRadio,dt.entry_type]]),((0,o.openBlock)(),(0,o.createElementBlock)('svg',Ee,[(0,o.createElementVNode)('path',{d:Nt},null,8,we)])),St[37]||(St[37]=(0,o.createTextVNode)(' 单体 (Single) ',-1))]),(0,o.createElementVNode)('label',Ve,[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[15]||(St[15]=e=>dt.entry_type=e),type:'radio',value:'List'},null,512),[[o.vModelRadio,dt.entry_type]]),((0,o.openBlock)(),(0,o.createElementBlock)('svg',Ne,[(0,o.createElementVNode)('path',{d:Ft},null,8,Fe)])),St[38]||(St[38]=(0,o.createTextVNode)(' 列表 (List) ',-1))])])])]),(0,o.createCommentVNode)(' 分隔符 '),(0,o.createElementVNode)('div',Me,[(0,o.createElementVNode)('div',De,[St[40]||(St[40]=(0,o.createElementVNode)('label',null,'主分隔符',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[16]||(St[16]=e=>dt.separator=e),type:'text',placeholder:'|'},null,512),[[o.vModelText,dt.separator]])]),'List'===dt.entry_type?((0,o.openBlock)(),(0,o.createElementBlock)('div',ze,[St[41]||(St[41]=(0,o.createElementVNode)('label',null,'次分隔符',-1)),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':St[17]||(St[17]=e=>dt.secondary_separator=e),type:'text',placeholder:'@'},null,512),[[o.vModelText,dt.secondary_separator]])])):(0,o.createCommentVNode)('v-if',!0)]),(0,o.createCommentVNode)(' Parts 结构定义 '),(0,o.createElementVNode)('div',Se,[(0,o.createElementVNode)('div',je,[St[43]||(St[43]=(0,o.createElementVNode)('label',null,'结构定义 (Parts)',-1)),(0,o.createElementVNode)('button',{class:'studio__btn studio__btn--small',onClick:_t},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',Ye,[(0,o.createElementVNode)('path',{d:ht},null,8,Te)])),St[42]||(St[42]=(0,o.createTextVNode)(' 添加 ',-1))])]),(0,o.createElementVNode)('div',Ie,[((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(dt.parts,(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{key:t,class:'studio__part-row'},[(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t=>e.key=t,type:'text',placeholder:'key',class:'studio__part-input'},null,8,Pe),[[o.vModelText,e.key]]),(0,o.withDirectives)((0,o.createElementVNode)('input',{'onUpdate:modelValue':t=>e.label=t,type:'text',placeholder:'标签',class:'studio__part-input'},null,8,Ue),[[o.vModelText,e.label]]),(0,o.withDirectives)((0,o.createElementVNode)('select',{'onUpdate:modelValue':t=>e.data_type=t,class:'studio__part-select'},[...St[44]||(St[44]=[(0,o.createElementVNode)('option',{value:'string'},'文本',-1),(0,o.createElementVNode)('option',{value:'number'},'数字',-1),(0,o.createElementVNode)('option',{value:'boolean'},'布尔',-1)])],8,Oe),[[o.vModelSelect,e.data_type]]),(0,o.createElementVNode)('div',$e,[(0,o.createElementVNode)('button',{class:'studio__mini-btn',disabled:0===t,onClick:e=>bt(t,-1)},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',qe,[(0,o.createElementVNode)('path',{d:Et},null,8,Re)]))],8,We),(0,o.createElementVNode)('button',{class:'studio__mini-btn',disabled:t===dt.parts.length-1,onClick:e=>bt(t,1)},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',Le,[(0,o.createElementVNode)('path',{d:wt},null,8,Ge)]))],8,He),(0,o.createElementVNode)('button',{class:'studio__mini-btn studio__mini-btn--danger',onClick:e=>function(e){dt.parts.splice(e,1)}(t)},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',Ze,[(0,o.createElementVNode)('path',{d:yt},null,8,Ke)]))],8,Qe)])]))),128))])]),(0,o.createCommentVNode)(' AI 描述 '),(0,o.createElementVNode)('div',Xe,[St[45]||(St[45]=(0,o.createElementVNode)('label',null,'AI 描述',-1)),(0,o.withDirectives)((0,o.createElementVNode)('textarea',{'onUpdate:modelValue':St[18]||(St[18]=e=>dt.description=e),rows:'3',placeholder:'给 AI 的说明，如：简述角色当前的生命状态'},null,512),[[o.vModelText,dt.description]])]),(0,o.createCommentVNode)(' 自动生成的格式 '),(0,o.createElementVNode)('div',Je,[St[46]||(St[46]=(0,o.createElementVNode)('label',null,'自动生成格式 (format)',-1)),(0,o.createElementVNode)('div',et,(0,o.toDisplayString)(Ct.value),1)])]),(0,o.createElementVNode)('div',tt,[(0,o.createElementVNode)('button',{class:'studio__btn',onClick:St[19]||(St[19]=e=>st.value=!1)},'取消'),(0,o.createElementVNode)('button',nt,[((0,o.openBlock)(),(0,o.createElementBlock)('svg',at,[(0,o.createElementVNode)('path',{d:zt},null,8,rt)])),St[47]||(St[47]=(0,o.createTextVNode)(' 注入世界书 ',-1))]),(0,o.createElementVNode)('button',{class:'studio__btn studio__btn--primary',onClick:vt},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',ot,[(0,o.createElementVNode)('path',{d:Bt},null,8,it)])),St[48]||(St[48]=(0,o.createTextVNode)(' 保存 ',-1))])])])])):(0,o.createCommentVNode)('v-if',!0)]))]))}});n(12);var lt=n(889);const dt=(0,lt.A)(st,[['__scopeId','data-v-06c478c0']]),ct={class:'manager__nav'},At=['title','onClick'],pt={class:'manager__nav-icon',viewBox:'0 0 24 24',width:'22',height:'22'},Ct=['d'],mt={class:'manager__main'},ut={class:'manager__header'},gt={class:'manager__title-group'},vt={class:'manager__title'},_t={class:'manager__subtitle'},bt={class:'manager__actions'},ft={class:'manager__btn manager__btn--primary',type:'button'},ht={viewBox:'0 0 24 24',width:'16',height:'16'},xt=['d'],yt={viewBox:'0 0 24 24',width:'20',height:'20',fill:'none',stroke:'currentColor','stroke-width':'2'},Bt=['d'],kt={class:'manager__content'},Et={class:'manager__placeholder'},wt={class:'manager__placeholder-icon',viewBox:'0 0 24 24',width:'64',height:'64'},Vt=['d'],Nt=(0,o.defineComponent)({__name:'ManagerModal',setup(e){const t=(0,o.ref)('data'),n=[{key:'data',name:'数据中心',icon:'database',desc:'管理角色状态数据'},{key:'definitions',name:'定义工坊',icon:'box',desc:'定义数据结构与元数据'},{key:'styles',name:'样式工坊',icon:'paintbrush',desc:'创建可复用样式单元'},{key:'layout',name:'布局编排',icon:'layout',desc:'可视化设计状态栏布局'},{key:'config',name:'系统配置',icon:'settings',desc:'预设、快照与系统设置'}],a=(0,o.computed)(()=>n.find(e=>e.key===t.value)),r={database:'M12 2C6.48 2 2 4.69 2 8v8c0 3.31 4.48 6 10 6s10-2.69 10-6V8c0-3.31-4.48-6-10-6zm0 2c4.42 0 8 1.79 8 4s-3.58 4-8 4-8-1.79-8-4 3.58-4 8-4zm8 12c0 2.21-3.58 4-8 4s-8-1.79-8-4v-2.18c1.86 1.38 4.78 2.18 8 2.18s6.14-.8 8-2.18V16z',box:'M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.36.2-.74.18-1.14 0l-7.9-4.44A.991.991 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.36-.2.74-.18 1.14 0l7.9 4.44c.32.17.53.5.53.88v9zM12 4.15 5.04 8 12 11.85 18.96 8 12 4.15z',paintbrush:'M20.71 4.63l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41zM7 14a3 3 0 0 0-3 3c0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2a4 4 0 0 0 4-4 3 3 0 0 0-3-3z',layout:'M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 7h4v4H7V7zm6 0h4v4h-4V7zM7 13h4v4H7v-4zm6 0h4v4h-4v-4z',settings:'M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z',close:'M18 6L6 18M6 6l12 12',save:'M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z'};function i(){const e=(window.parent??window).document,t=new CustomEvent('th:manager-close');e.documentElement.dispatchEvent(t)}return(e,s)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',{class:'manager',onClick:s[0]||(s[0]=(0,o.withModifiers)(()=>{},['stop']))},[(0,o.createCommentVNode)(' 左侧图标导航栏 '),(0,o.createElementVNode)('nav',ct,[((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,(0,o.renderList)(n,e=>(0,o.createElementVNode)('button',{key:e.key,type:'button',class:(0,o.normalizeClass)(['manager__nav-item',{'manager__nav-item--active':t.value===e.key}]),title:e.name,onClick:n=>t.value=e.key},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',pt,[(0,o.createElementVNode)('path',{d:r[e.icon],fill:'currentColor'},null,8,Ct)]))],10,At)),64))]),(0,o.createCommentVNode)(' 主内容区 '),(0,o.createElementVNode)('div',mt,[(0,o.createCommentVNode)(' 顶部标题栏 '),(0,o.createElementVNode)('header',ut,[(0,o.createElementVNode)('div',gt,[(0,o.createElementVNode)('h1',vt,(0,o.toDisplayString)(a.value?.name),1),(0,o.createElementVNode)('p',_t,(0,o.toDisplayString)(a.value?.desc),1)]),(0,o.createElementVNode)('div',bt,[(0,o.createElementVNode)('button',ft,[((0,o.openBlock)(),(0,o.createElementBlock)('svg',ht,[(0,o.createElementVNode)('path',{d:r.save,fill:'currentColor'},null,8,xt)])),s[1]||(s[1]=(0,o.createElementVNode)('span',null,'保存',-1))]),(0,o.createElementVNode)('button',{class:'manager__btn manager__btn--close',type:'button',onClick:i},[((0,o.openBlock)(),(0,o.createElementBlock)('svg',yt,[(0,o.createElementVNode)('path',{d:r.close},null,8,Bt)]))])])]),(0,o.createCommentVNode)(' 模块内容区 '),(0,o.createElementVNode)('main',kt,[(0,o.createCommentVNode)(' 定义工坊 '),'definitions'===t.value?((0,o.openBlock)(),(0,o.createBlock)(dt,{key:0})):((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,{key:1},[(0,o.createCommentVNode)(' 占位符 (其他模块开发中) '),(0,o.createElementVNode)('div',Et,[((0,o.openBlock)(),(0,o.createElementBlock)('svg',wt,[(0,o.createElementVNode)('path',{d:r[a.value?.icon||'database'],fill:'currentColor'},null,8,Vt)])),(0,o.createElementVNode)('h2',null,(0,o.toDisplayString)(a.value?.name),1),s[2]||(s[2]=(0,o.createElementVNode)('p',{class:'manager__placeholder-text'},'此模块正在开发中...',-1)),s[3]||(s[3]=(0,o.createElementVNode)('p',{class:'manager__placeholder-hint'},'框架已成功加载！后续将逐步完善各项功能',-1))])],2112))]),(0,o.createCommentVNode)(' 底部状态栏 '),s[4]||(s[4]=(0,o.createElementVNode)('footer',{class:'manager__footer'},[(0,o.createElementVNode)('span',null,'通用状态栏框架 v0.1.0'),(0,o.createElementVNode)('span',{class:'manager__footer-status'},'浅色模式 · 开发中')],-1))])]))}});n(80);const Ft=(0,lt.A)(Nt,[['__scopeId','data-v-c6c4011c']]),Mt={class:'status-bar'},Dt={class:'status-bar__header'},zt={key:0,class:'status-bar__streaming'},St=(0,o.defineComponent)({__name:'StatusBar',setup(e){const t=(0,o.readonly)((0,o.inject)('streaming_message_context'));return(e,n)=>((0,o.openBlock)(),(0,o.createElementBlock)('div',Mt,[(0,o.createElementVNode)('div',Dt,[(0,o.createElementVNode)('svg',{class:'status-bar__icon',viewBox:'0 0 24 24',width:'18',height:'18'},[(0,o.createElementVNode)('path',{d:'M12 2C6.48 2 2 4.69 2 8v8c0 3.31 4.48 6 10 6s10-2.69 10-6V8c0-3.31-4.48-6-10-6zm0 2c4.42 0 8 1.79 8 4s-3.58 4-8 4-8-1.79-8-4 3.58-4 8-4zm8 12c0 2.21-3.58 4-8 4s-8-1.79-8-4v-2.18c1.86 1.38 4.78 2.18 8 2.18s6.14-.8 8-2.18V16z',fill:'currentColor'})]),n[0]||(n[0]=(0,o.createElementVNode)('span',{class:'status-bar__title'},'通用状态栏',-1)),(0,o.unref)(t).during_streaming?((0,o.openBlock)(),(0,o.createElementBlock)('span',zt,'生成中...')):(0,o.createCommentVNode)('v-if',!0)]),n[1]||(n[1]=(0,o.createElementVNode)('div',{class:'status-bar__content'},[(0,o.createElementVNode)('div',{class:'status-bar__placeholder'},[(0,o.createElementVNode)('span',null,'暂无状态数据'),(0,o.createElementVNode)('span',{class:'status-bar__hint'},'点击扩展菜单中的「通用状态栏管理器」添加定义')])],-1))]))}});n(109);const jt=(0,lt.A)(St,[['__scopeId','data-v-0aa8f2f0']]),Yt='通用状态栏管理器',Tt='th-statusbar-manager-container',It='__th_statusbar_owner__',Pt=window.parent??window;function Ut(){return Pt[It]??null}let Ot=null,$t=null,Wt=null;async function qt(){if(Ot){if(Ot.css('display','flex'),!$t){Wt=a($(Pt.document.head)).destroy;const e=$('<div>').appendTo(Ot);$t=(0,o.createApp)(Ft),$t.mount(e[0])}console.log('[状态栏] 管理器已打开')}}function Rt(){Ot&&(Ot.css('display','none'),console.log('[状态栏] 管理器已关闭'))}function Ht(){if(!Ot)return;'none'!==Ot.css('display')?Rt():qt()}let Lt=null;function Gt(){const e=crypto?.randomUUID?.()??`${Date.now()}-${Math.random().toString(36).slice(2)}`,t=Ut();t&&(console.log('[状态栏] 检测到旧实例，正在清理...'),t.cleanup());var n;n={id:e,cleanup:()=>{console.log('[状态栏] 正在清理...'),$t&&($t.unmount(),$t=null),Wt?.(),Wt=null,Ot?.remove(),Ot=null,Lt?.(),Lt=null,replaceScriptButtons([]),delete Pt.__thStatusBarManager,delete Pt[It]}},Pt[It]=n,Ot=function(){const e=Pt.document.querySelector(`#${Tt}`);e&&e.remove();const t=$(Pt.document.createElement('div')).attr('id',Tt).css({position:'fixed',top:0,left:0,width:'100vw',height:'100vh',zIndex:99999,display:'none',backgroundColor:'rgba(0, 0, 0, 0.5)',alignItems:'center',justifyContent:'center'}).appendTo(Pt.document.body);return Pt.document.documentElement.addEventListener('th:manager-close',Rt),t}(),Ot.on('click',e=>{e.target===Ot[0]&&Rt()}),replaceScriptButtons([{name:Yt,visible:!0}]),eventOn(getButtonEvent(Yt),qt),async function(){const{unmount:e}=i(()=>(0,o.createApp)(jt),{host:'iframe',filter:(e,t)=>{const n=getChatMessages(e);return 0!==n.length&&'assistant'===n[0].role}});Lt=e,console.log('[状态栏] 流式界面已初始化')}(),Pt.__thStatusBarManager={show:qt,hide:Rt,toggle:Ht,isVisible:()=>'none'!==Ot?.css('display')},console.log('[状态栏] 初始化完成')}$(()=>{try{Gt()}catch(e){console.error('[状态栏] 初始化失败:',e),toastr.error(`状态栏初始化失败: ${e.message}`,'错误')}$(window).on('pagehide',()=>{const e=Ut();e?.cleanup()})});
//# sourceMappingURL=index.js.map